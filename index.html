<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aircraft Performance & Personnel W&B</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ITPS Tools">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/753/753235.png">
    <link rel="manifest" href="manifest.json">
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap");


        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            min-height: 100vh;
            color: #1f2937;
            overflow-x: hidden;
            position: relative;
        }

        #stars,
        #stars2,
        #stars3 {
            position: fixed;
            top: 0;
            left: 0;
            background: transparent;
            z-index: -1;
            /* GPU Acceleration */
            will-change: transform;
            backface-visibility: hidden;
            transform: translate3d(0, 0, 0);
        }

        #stars {
            width: 1px;
            height: 1px;
            animation: animStar 50s linear infinite;
        }

        #stars::after {
            content: " ";
            position: absolute;
            top: 2000px;
            width: 1px;
            height: 1px;
            background: transparent;
            box-shadow: inherit;
        }

        #stars2 {
            width: 2px;
            height: 2px;
            animation: animStar 100s linear infinite;
        }

        #stars2::after {
            content: " ";
            position: absolute;
            top: 2000px;
            width: 2px;
            height: 2px;
            background: transparent;
            box-shadow: inherit;
        }

        #stars3 {
            width: 3px;
            height: 3px;
            animation: animStar 150s linear infinite;
        }

        #stars3::after {
            content: " ";
            position: absolute;
            top: 2000px;
            width: 3px;
            height: 3px;
            background: transparent;
            box-shadow: inherit;
        }

        @keyframes animStar {
            from {
                transform: translate3d(0, 0, 0);
            }

            to {
                transform: translate3d(0, -2000px, 0);
            }
        }

        #stars,
        #stars2,
        #stars3 {
            will-change: transform;
            contain: strict;
        }

        .container {
            max-width: 56rem;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .card {
            background: rgba(241, 245, 249, 0.98);
            backdrop-filter: blur(5px);
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.25);
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.5);
            contain: content;
            content-visibility: auto;
            contain-intrinsic-size: 1px 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            width: 100%;
            padding: 1.25rem;
            border: none;
            border-radius: 0.75rem;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.4);
        }

        /* Magnetic Field Dashboard Buttons */
        .btn-premium-dashboard {
            position: relative;
            padding: 1rem 0.75rem;
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: white;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.6rem;
            overflow: visible;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            width: 100%;
            height: 100%;
            z-index: 1;
            contain: layout paint;
            transform: translateZ(0);
        }

        .btn-premium-dashboard:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px 0 rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.4);
        }


        .btn-premium-dashboard .btn-icon {
            font-size: 1.5rem;
            transition: transform 0.3s ease;
        }

        .btn-premium-dashboard:hover .btn-icon {
            transform: scale(1.2) rotate(8deg);
        }

        .btn-premium-dashboard .btn-text {
            font-weight: 800;
            font-size: 0.85rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .btn-premium-dashboard:active {
            transform: scale(0.95);
        }

        .btn-premium-dashboard .btn-icon {
            font-size: 1.5rem;
            margin-bottom: 0.1rem;
        }

        .btn-premium-dashboard .btn-text {
            font-size: 0.85rem;
            font-weight: 900;
        }

        .btn-back {
            color: #60a5fa;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 2rem;
            background: none;
            border: none;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-back:hover {
            color: #93c5fd;
        }

        .input-group {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
        }

        .input-group label {
            display: block;
            font-size: 0.9rem;
            font-weight: 700;
            color: #475569;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            font-size: 1.1rem;
            transition: all 0.2s;
        }

        .input-group input:focus,
        .input-group select:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .input-group input:disabled {
            background: #f1f5f9;
            cursor: not-allowed;
        }

        .results {
            margin-top: 2rem;
            padding: 2rem;
            background: #ecfdf5;
            border: 2px solid #10b981;
            border-radius: 1.25rem;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: white;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .result-label {
            color: #475569;
            font-weight: 600;
        }

        .result-value {
            font-size: 1.4rem;
            font-weight: 800;
            color: #059669;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .text-center {
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 900;
            color: white;
            margin-bottom: 1rem;
            letter-spacing: -0.025em;
            text-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        h2 {
            font-size: 2rem;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 2rem;
            border-bottom: 4px solid #3b82f6;
            display: inline-block;
            padding-bottom: 0.5rem;
        }

        h3 {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1rem;
        }

        p {
            color: #94a3b8;
            margin-bottom: 3rem;
            font-size: 1.1rem;
        }

        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            flex-direction: column;
        }

        .aircraft-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 2rem;
            width: 100%;
            max-width: 800px;
        }

        .runway-option {
            padding: 2rem;
            border: 3px solid #e2e8f0;
            border-radius: 1.25rem;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            margin-bottom: 1.5rem;
        }

        .runway-option:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
            transform: translateY(-3px);
        }

        .runway-option.selected {
            border-color: #2563eb;
            background: #eff6ff;
            box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.1);
        }

        .module-result {
            background: white;
            border-radius: 1rem;
            padding: 1.75rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .app-layout {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 2rem;
            align-items: start;
            width: 100%;
            max-width: 90rem;
            padding: 1.5rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.7rem;
            margin-top: 1rem;
            width: 100%;
            max-width: 380px;
            /* Narrower for single column */
            margin-left: auto;
            margin-right: auto;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .card {
                padding: 1.25rem;
                border-radius: 1rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .btn-hero .btn-icon {
                font-size: 2.2rem !important;
            }

            .btn-premium-dashboard {
                padding: 1.25rem;
                border-radius: 1.5rem;
            }

            .btn-premium-dashboard .btn-icon {
                font-size: 2.2rem;
            }

            h1 {
                font-size: 1.75rem !important;
            }
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border-radius: 1.5rem;
            padding: 1.5rem;
            color: #f8fafc;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: calc(100vh - 3rem);
            overflow-y: auto;
            position: sticky;
            top: 1.5rem;
        }

        .sidebar-title {
            font-size: 1.25rem;
            font-weight: 900;
            margin-bottom: 1.5rem;
            color: #60a5fa;
            border-bottom: 2px solid rgba(96, 165, 250, 0.2);
            padding-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .personnel-list-item {
            font-size: 0.85rem;
            padding: 0.65rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .personnel-list-item:last-child {
            border-bottom: none;
        }

        .personnel-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .personnel-name {
            font-weight: 600;
            color: #f1f5f9;
        }

        .personnel-weight {
            font-family: monospace;
            font-weight: 700;
            color: #38bdf8;
        }

        .personnel-call {
            font-size: 0.75rem;
            color: #94a3b8;
            font-weight: 500;
        }

        @media (max-width: 1024px) {
            .app-layout {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: static;
                max-height: 400px;
            }
        }

        .module-title {
            font-size: 1.3rem;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border-left: 5px solid #3b82f6;
            padding-left: 1rem;
        }

        .weight-subtitle {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 600;
            margin-left: auto;
            background: #f1f5f9;
            padding: 0.25rem 0.75rem;
            border-radius: 2rem;
        }

        .manual-weight-prompt {
            margin-top: 0.5rem;
            padding: 1rem;
            background: #fff7ed;
            border: 1px solid #fed7aa;
            border-radius: 0.75rem;
        }

        .manual-weight-prompt label {
            color: #c2410c;
        }

        .disclaimer-card {
            background: rgba(254, 242, 242, 0.2);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(239, 68, 68, 0.4);
            color: #fca5a5;
            padding: 0.75rem;
            border-radius: 0.75rem;
            margin-top: 1.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            line-height: 1.4;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
        }

        .disclaimer-title {
            font-weight: 800;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            font-size: 0.7rem;
        }

        footer {
            margin-top: 3rem;
            color: #94a3b8;
            font-size: 0.85rem;
            text-align: center;
            width: 100%;
        }

        @media (max-width: 768px) {
            .aircraft-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2rem;
            }
        }

        /* W&B Manual Weight Prompt */
        .manual-weight-prompt {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: #faf5ff;
            border-radius: 0.5rem;
            border: 1px solid #e9d5ff;
        }

        .manual-weight-prompt label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.75rem;
            color: #6b21a8;
            font-weight: 700;
        }

        .manual-weight-prompt input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d8b4fe;
            border-radius: 0.35rem;
            font-size: 0.9rem;
        }

        /* Fleet Table Styles */
        .fleet-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            background: white;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .fleet-table th {
            background: #1e293b;
            color: white;
            text-align: left;
            padding: 1rem;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .fleet-table td {
            padding: 0.85rem 1rem;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.9rem;
            color: #334155;
        }

        .fleet-table tr:last-child td {
            border-bottom: none;
        }

        .fleet-table tr:hover {
            background: #f8fafc;
        }

        .humorous-note {
            font-size: 0.85rem;
            color: #7c3aed;
            font-style: italic;
            margin-bottom: 1.5rem;
            font-weight: 600;
            text-align: center;
            background: #f5f3ff;
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: 1px dashed #c084fc;
        }

        .btn-feedback {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            color: #94a3b8;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            text-decoration: none;
            font-size: 0.75rem;
            font-weight: 700;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1rem;
        }

        .btn-feedback:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-color: #3b82f6;
            transform: translateY(-1px);
        }

        /* Flight Test Master Styles */
        .ftm-table-row {
            display: grid;
            grid-template-columns: 45px 1fr 80px 80px 60px;
            gap: 6px;
            padding: 12px;
            border-bottom: 1px solid #e5e5ea;
            align-items: center;
            transition: background 0.1s;
            cursor: pointer;
        }

        .ftm-table-row:hover {
            background: #f9f9f9;
        }

        .ftm-selected {
            background: #E5F1FF !important;
        }

        .ftm-row-completed {
            background-color: rgba(52, 199, 89, 0.15) !important;
        }

        .ftm-row-skipped {
            background-color: rgba(255, 149, 0, 0.15) !important;
        }

        /* Calendar Styles */
        .calendar-grid {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
            max-height: 50vh;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .calendar-event {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            transition: all 0.3s ease;
            text-align: left;
        }

        .calendar-event:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .event-time {
            font-size: 0.75rem;
            color: #a78bfa;
            font-weight: 700;
        }

        .event-title {
            font-size: 0.95rem;
            color: white;
            font-weight: 800;
        }

        .event-details {
            font-size: 0.8rem;
            color: #94a3b8;
        }

        .btn-refresh-calendar {
            background: rgba(167, 139, 250, 0.2);
            border: 1px solid rgba(167, 139, 250, 0.4);
            color: #c4b5fd;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .btn-refresh-calendar:hover {
            background: rgba(167, 139, 250, 0.3);
            border-color: #a78bfa;
            color: white;
        }

        .calendar-loading {
            padding: 2rem;
            color: #94a3b8;
            font-style: italic;
        }

        .ftm-table-input {
            width: 100%;
            border: 1px solid transparent;
            padding: 4px;
            border-radius: 4px;
            font-size: 15px;
            background: transparent;
            text-align: center;
        }

        .ftm-table-input:focus {
            background: #f2f2f7;
            border-color: #007AFF;
            outline: none;
        }

        /* Split-Hover Title Effect */
        .split-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 80px;
            z-index: 2;
            margin-bottom: 0.25rem;
            overflow: visible;
        }

        .split-title {
            margin: 0;
            padding: 0;
            position: relative;
            font-size: 3.5rem;
            color: transparent;
            text-transform: uppercase;
            font-family: 'Consolas', monospace;
            cursor: pointer;
            white-space: nowrap;
        }

        .split-title span:nth-child(1) {
            position: absolute;
            top: 0;
            left: 0;
            color: #f8fafc;
            transition: 0.5s;
            clip-path: polygon(0 0, 100% 0, 100% 50%, 0 50%);
            overflow: hidden;
            width: 100%;
            text-align: center;
        }

        .split-title:hover span:nth-child(1) {
            transform: translateY(-18px);
        }

        .split-title span:nth-child(2) {
            position: absolute;
            top: 0;
            left: 0;
            color: #f8fafc;
            transition: 0.5s;
            clip-path: polygon(0 50%, 100% 50%, 100% 100%, 0 100%);
            overflow: hidden;
            width: 100%;
            text-align: center;
        }

        .split-title:hover span:nth-child(2) {
            transform: translateY(18px);
        }

        .split-title span:nth-child(3) {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scaleY(0);
            width: 100%;
            color: #000;
            background: #ff0;
            font-size: 0.25em;
            font-weight: 900;
            letter-spacing: 0.7em;
            text-align: center;
            padding: 5px 0;
            transition: 0.5s;
            z-index: 5;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .split-title:hover span:nth-child(3) {
            transform: translate(-50%, -50%) scaleY(1);
        }

        @media (max-width: 768px) {
            .split-title {
                font-size: 2rem;
            }

            .split-container {
                height: 60px;
            }
        }
    </style>
</head>

<body>
    <div id="root"></div>
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>
    <script>
        // Star Generator for Sarazond Effect
        function generateStars(count) {
            let stars = "";
            for (let i = 0; i < count; i++) {
                stars += `${Math.floor(Math.random() * 2000)}px ${Math.floor(Math.random() * 2000)}px #FFF${i < count - 1 ? "," : ""}`;
            }
            return stars;
        }

        document.getElementById('stars').style.boxShadow = generateStars(100);
        document.getElementById('stars2').style.boxShadow = generateStars(40);
        document.getElementById('stars3').style.boxShadow = generateStars(20);

        const CGRAS_DATA = {
            takeoff: {
                altitudes: [0, 2000, 4000, 6000, 8000, 10000],
                temps: [-20, -10, 0, 10, 20, 30, 40],
                groundRoll: { 0: [1190, 1300, 1420, 1550, 1690, 1850, 2020], 2000: [1340, 1470, 1610, 1750, 1910, 2140, 2340], 4000: [1510, 1650, 1810, 2020, 2210, 2420, 2650], 6000: [1710, 1910, 2090, 2280, 2500, 2740, 3010], 8000: [1970, 2160, 2370, 2590, 2840, 3120, 3430], 10000: [2240, 2460, 2690, 2950, 3240, 3560, 3930] },
                totalDist: { 0: [1570, 1720, 1890, 2070, 2290, 2550, 2860], 2000: [1790, 1920, 2110, 2330, 2560, 2930, 3310], 4000: [1950, 2150, 2370, 2660, 2970, 3330, 3800], 6000: [2200, 2450, 2710, 3010, 3370, 3820, 4420], 8000: [2510, 2770, 3070, 3430, 3860, 4430, 5240], 10000: [2840, 3140, 3500, 3930, 4470, 5220, 5440] }
            },
            accelstop: {
                altitudes: [0, 1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000],
                temps: [-20, -10, 0, 10, 20, 30, 40],
                weights: [5990, 5500, 5000],
                data: {
                    5990: { 0: [2770, 2940, 3120, 3310, 3510, 3730, 3970], 1000: [2900, 3080, 3270, 3470, 3690, 3920, 4220], 2000: [3030, 3220, 3430, 3640, 3870, 4160, 4430], 3000: [3180, 3380, 3590, 3820, 4110, 4370, 4660], 4000: [3340, 3550, 3770, 4060, 4320, 4600, 4900], 5000: [3500, 3730, 4000, 4260, 4540, 4830, 5160], 6000: [3680, 3950, 4200, 4480, 4770, 5090, 5430], 7000: [3890, 4150, 4420, 4710, 5020, 5360, 5730], 8000: [4090, 4360, 4650, 4960, 5290, 5650, 6050], 9000: [4300, 4590, 4900, 5230, 5580, 5970, 6390], 10000: [4530, 4830, 5150, 5310, 5890, 6300, 6750] },
                    5500: { 0: [2280, 2420, 2570, 2720, 2890, 3070, 3260], 1000: [2390, 2540, 2690, 2860, 3030, 3220, 3420], 2000: [2500, 2660, 2820, 3000, 3180, 3380, 3590], 3000: [2620, 2790, 2960, 3140, 3340, 3550, 3820], 4000: [2750, 2920, 3110, 3300, 3510, 3770, 4020], 5000: [2890, 3070, 3260, 3470, 3730, 3970, 4230], 6000: [3030, 3230, 3430, 3680, 3920, 4180, 4450], 7000: [3190, 3390, 3640, 3870, 4120, 4400, 4690], 8000: [3350, 3590, 3830, 4080, 4340, 4630, 4950], 9000: [3580, 3780, 4030, 4290, 4580, 4890, 5220], 10000: [3730, 3980, 4240, 4530, 4830, 5160, 5520] },
                    5000: { 0: [1840, 1950, 2070, 2200, 2330, 2470, 2610], 1000: [1930, 2050, 2170, 2300, 2440, 2590, 2740], 2000: [2020, 2140, 2270, 2410, 2560, 2710, 2880], 3000: [2120, 2250, 2390, 2530, 2690, 2850, 3030], 4000: [2220, 2360, 2500, 2660, 2820, 3000, 3180], 5000: [2330, 2480, 2630, 2790, 2970, 3150, 3350], 6000: [2450, 2600, 2760, 2940, 3120, 3320, 3570], 7000: [2570, 2730, 2910, 3090, 3290, 3530, 3760], 8000: [2700, 2880, 3060, 3260, 3490, 3710, 3960], 9000: [2850, 3030, 3230, 3450, 3670, 3910, 4170], 10000: [3000, 3190, 3410, 3640, 3870, 4130, 4410] }
                }
            },
            landing: {
                altitudes: [0, 2000, 4000, 6000, 8000, 10000],
                temps: [-20, -10, 0, 10, 20, 30, 40],
                groundRoll: { 0: [694, 724, 745, 777, 806, 826, 857], 2000: [745, 775, 806, 836, 867, 898, 918], 4000: [805, 836, 867, 898, 928, 959, 989], 6000: [867, 898, 928, 969, 1000, 1030, 1071], 8000: [928, 969, 1010, 1040, 1081, 1112, 1153], 10000: [1010, 1051, 1091, 1122, 1163, 1204, 1244] },
                totalDist: { 0: [1795, 1816, 1948, 1928, 1958, 1989, 1958], 2000: [1846, 1877, 1897, 1928, 1897, 1928, 2020], 4000: [1897, 1928, 1958, 1999, 1994, 2060, 2091], 6000: [1958, 1999, 2030, 2060, 2101, 2132, 2162], 8000: [2030, 2071, 2101, 2142, 2173, 2213, 2254], 10000: [2101, 2142, 2183, 2224, 2264, 2305, 2346] }
            },
            balked: {
                altitudes: [0, 2000, 4000, 6000, 8000],
                temps: [-25, 0, 25, 50, 75, 100], // Fahrenheit
                data: { 0: [1342, 1188, 1034, 880, 704, 583], 2000: [1254, 1100, 946, 803, 633, 506], 4000: [1166, 1023, 869, 726, 550, 429], 6000: [1095, 935, 786, 638, 473, 352], 8000: [1001, 853, 704, 550, 396, 275] }
            },
            oei: {
                altitudes: [0, 2000, 4000, 6000, 8000, 10000, 12000, 14000],
                temps: [-25, 0, 25, 50, 75, 100], // Fahrenheit
                weights: [6390, 6000, 5500, 5000],
                data: { 6390: { 0: [387, 330, 273, 217, 162, 107], 2000: [361, 303, 235, 178, 121, 66], 4000: [323, 263, 204, 146, 88, 31], 6000: [281, 220, 160, 100, 41, -17], 8000: [236, 176, 115, 54, -8, -65], 10000: [194, 130, 67, 5, -56, -116], 12000: [143, 79, 14, -40, -112, -173], 14000: [95, 28, -37, -101, -165, -228] }, 6000: { 0: [500, 441, 394, 326, 270, 214], 2000: [465, 405, 346, 288, 230, 173], 4000: [438, 377, 317, 257, 198, 130], 6000: [397, 334, 273, 212, 152, 92], 8000: [355, 292, 229, 167, 106, 45], 10000: [311, 249, 182, 119, 57, -3], 12000: [261, 195, 130, 65, 2, -61], 14000: [208, 141, 75, 8, -56, -120] }, 5500: { 0: [699, 598, 538, 479, 420, 362], 2000: [626, 563, 502, 441, 381, 322], 4000: [600, 537, 474, 412, 351, 291], 6000: [559, 495, 431, 368, 306, 244], 8000: [519, 453, 388, 324, 261, 198], 10000: [476, 409, 343, 278, 213, 149], 12000: [426, 358, 291, 224, 159, 94], 14000: [370, 300, 232, 164, 98, 32] }, 5000: { 0: [839, 776, 713, 650, 589, 528], 2000: [800, 741, 677, 613, 550, 488], 4000: [762, 716, 651, 586, 522, 459], 6000: [742, 675, 608, 543, 477, 413], 8000: [702, 634, 566, 499, 433, 367], 10000: [660, 590, 522, 453, 386, 319], 12000: [611, 540, 470, 400, 332, 264], 14000: [549, 477, 406, 336, 266, 198] } }
            }
        };
        const CGZSN_DATA = {
            takeoff: { altitudes: [0, 2000, 4000, 6000, 8000, 10000], temps: [-20, -10, 0, 10, 20, 30, 40], groundRoll: { 0: [1190, 1300, 1420, 1550, 1690, 1850, 2020], 2000: [1340, 1470, 1610, 1750, 1910, 2140, 2340], 4000: [1510, 1650, 1810, 2020, 2210, 2420, 2650], 6000: [1710, 1910, 2090, 2280, 2500, 2740, 3010], 8000: [1970, 2160, 2370, 2590, 2840, 3120, 3430], 10000: [2240, 2460, 2690, 2950, 3240, 3560, 3930] }, totalDist: { 0: [1570, 1720, 1890, 2070, 2290, 2550, 2860], 2000: [1790, 1920, 2110, 2330, 2560, 2930, 3310], 4000: [1950, 2150, 2370, 2660, 2970, 3330, 3800], 6000: [2200, 2450, 2710, 3010, 3370, 3820, 4420], 8000: [2510, 2770, 3070, 3430, 3860, 4430, 5240], 10000: [2840, 3140, 3500, 3930, 4470, 5220, 5440] } },
            accelstop: { altitudes: [0, 1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000], temps: [-20, -10, 0, 10, 20, 30, 40], weights: [5990, 5500, 5000], data: { 5990: { 0: [2770, 2940, 3120, 3310, 3510, 3730, 3970], 1000: [2900, 3080, 3270, 3470, 3690, 3920, 4220], 2000: [3030, 3220, 3430, 3640, 3870, 4160, 4430], 3000: [3180, 3380, 3590, 3820, 4110, 4370, 4660], 4000: [3340, 3550, 3770, 4060, 4320, 4600, 4900], 5000: [3500, 3730, 4000, 4260, 4540, 4830, 5160], 6000: [3680, 3950, 4200, 4480, 4770, 5090, 5430], 7000: [3890, 4150, 4420, 4710, 5020, 5360, 5730], 8000: [4090, 4360, 4650, 4960, 5290, 5650, 6050], 9000: [4300, 4590, 4900, 5230, 5580, 5970, 6390], 10000: [4530, 4830, 5150, 5310, 5890, 6300, 6750] }, 5500: { 0: [2280, 2420, 2570, 2720, 2890, 3070, 3260], 1000: [2390, 2540, 2690, 2860, 3030, 3220, 3420], 2000: [2500, 2660, 2820, 3000, 3180, 3380, 3590], 3000: [2620, 2790, 2960, 3140, 3340, 3550, 3820], 4000: [2750, 2920, 3110, 3300, 3510, 3770, 4020], 5000: [2890, 3070, 3260, 3470, 3730, 3970, 4230], 6000: [3030, 3230, 3430, 3680, 3920, 4180, 4450], 7000: [3190, 3390, 3640, 3870, 4120, 4400, 4690], 8000: [3350, 3590, 3830, 4080, 4340, 4630, 4950], 9000: [3580, 3780, 4030, 4290, 4580, 4890, 5220], 10000: [3730, 3980, 4240, 4530, 4830, 5160, 5520] }, 5000: { 0: [1840, 1950, 2070, 2200, 2330, 2470, 2610], 1000: [1930, 2050, 2170, 2300, 2440, 2590, 2740], 2000: [2020, 2140, 2270, 2410, 2560, 2710, 2880], 3000: [2120, 2250, 2390, 2530, 2690, 2850, 3030], 4000: [2220, 2360, 2500, 2660, 2820, 3000, 3180], 5000: [2330, 2480, 2630, 2790, 2970, 3150, 3350], 6000: [2450, 2600, 2760, 2940, 3120, 3320, 3570], 7000: [2570, 2730, 2910, 3090, 3290, 3530, 3760], 8000: [2700, 2880, 3060, 3260, 3490, 3710, 3960], 9000: [2850, 3030, 3230, 3450, 3670, 3910, 4170], 10000: [3000, 3190, 3410, 3640, 3870, 4130, 4410] } } },
            landing: { altitudes: [0, 2000, 4000, 6000, 8000, 10000], temps: [-20, -10, 0, 10, 20, 30, 40], groundRoll: { 0: [694, 724, 745, 775, 808, 826, 857], 2000: [745, 775, 806, 836, 867, 898, 918], 4000: [806, 836, 867, 898, 928, 959, 989], 6000: [867, 898, 928, 969, 1000, 1030, 1071], 8000: [928, 969, 1010, 1040, 1081, 1112, 1153], 10000: [1010, 1051, 1091, 1122, 1163, 1204, 1244] }, totalDist: { 0: [1795, 1816, 1848, 1848, 1877, 1928, 1958], 2000: [1846, 1877, 1897, 1958, 1897, 1958, 2020], 4000: [1897, 1928, 1958, 2030, 1994, 2060, 2091], 6000: [1958, 1999, 2030, 2060, 2101, 2132, 2152], 8000: [2030, 2071, 2101, 2142, 2173, 2213, 2254], 10000: [2101, 2142, 2183, 2224, 2264, 2305, 2346] } },
            balked: { altitudes: [0, 2000, 4000, 6000, 8000], temps: [-25, 0, 25, 50, 75, 100], data: { 0: [1342, 1188, 1034, 880, 704, 583], 2000: [1254, 1100, 946, 803, 633, 506], 4000: [1166, 1023, 869, 726, 550, 429], 6000: [1095, 935, 786, 638, 473, 352], 8000: [1001, 853, 704, 550, 396, 275] } },
            oei: { altitudes: [0, 2000, 4000, 6000, 8000, 10000, 12000, 14000], temps: [-25, 0, 25, 50, 75, 100], weights: [6390, 6000, 5500, 5000], data: { 6390: { 0: [387, 330, 273, 217, 162, 107], 2000: [361, 303, 235, 178, 121, 66], 4000: [323, 263, 204, 146, 88, 31], 6000: [281, 220, 160, 100, 41, -17], 8000: [236, 176, 115, 54, -8, -65], 10000: [194, 130, 67, 5, -56, -116], 12000: [143, 79, 14, -40, -112, -173], 14000: [95, 28, -37, -101, -165, -228] }, 6000: { 0: [500, 441, 394, 326, 270, 214], 2000: [465, 405, 346, 288, 230, 173], 4000: [438, 377, 317, 257, 198, 130], 6000: [397, 334, 273, 212, 152, 92], 8000: [355, 292, 229, 167, 106, 45], 10000: [311, 249, 182, 119, 57, -3], 12000: [261, 195, 130, 65, 2, -61], 14000: [208, 141, 75, 8, -56, -120] }, 5500: { 0: [699, 598, 538, 479, 420, 362], 2000: [626, 563, 502, 441, 381, 322], 4000: [600, 537, 474, 412, 351, 291], 6000: [559, 495, 431, 368, 306, 244], 8000: [519, 453, 388, 324, 261, 198], 10000: [476, 409, 343, 278, 213, 149], 12000: [426, 358, 291, 224, 159, 94], 14000: [370, 300, 232, 164, 98, 32] }, 5000: { 0: [839, 776, 713, 650, 589, 528], 2000: [800, 741, 677, 613, 550, 488], 4000: [762, 716, 651, 586, 522, 459], 6000: [742, 675, 608, 543, 477, 413], 8000: [702, 634, 566, 499, 433, 367], 10000: [660, 590, 522, 453, 386, 319], 12000: [611, 540, 470, 400, 332, 264], 14000: [549, 477, 406, 336, 266, 198] } } }
        };
        const CFYWI_DATA = {
            takeoff: { altitudes: [0, 1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000], temps: [0, 10, 20, 30, 40], weights: [3400, 2900], groundRoll: { 3400: { 0: [917, 990, 1067, 1146, 1229], 1000: [1011, 1092, 1176, 1264, 1355], 2000: [1116, 1206, 1299, 1395, 1496], 3000: [1234, 1332, 1435, 1542, 1653], 4000: [1365, 1474, 1588, 1706, 1829], 5000: [1512, 1633, 1758, 1889, 2025], 6000: [1676, 1810, 1950, 2095, 2245], 7000: [1861, 2009, 2164, 2325, 2492], 8000: [2068, 2239, 2406, 2584, 2770], 9000: [2302, 2485, 2677, 2875, 3082], 10000: [2564, 2769, 2982, 3204, 3434] }, 2900: { 0: [610, 659, 710, 763, 818], 1000: [673, 727, 783, 841, 902], 2000: [743, 802, 864, 929, 995], 3000: [821, 887, 955, 1025, 1100], 4000: [908, 981, 1057, 1135, 1217], 5000: [1006, 1086, 1170, 1257, 1348], 6000: [1116, 1205, 1298, 1394, 1494], 7000: [1238, 1337, 1440, 1547, 1659], 8000: [1376, 1485, 1599, 1720, 1843], 9000: [1532, 1654, 1781, 1914, 2051], 10000: [1707, 1843, 1986, 2135, 2292] } }, totalDist: { 3400: { 0: [1432, 1539, 1650, 1764, 1883], 1000: [1574, 1691, 1813, 1939, 2069], 2000: [1732, 1861, 1995, 2133, 2276], 3000: [1907, 2049, 2196, 2349, 2507], 4000: [2102, 2259, 2422, 2590, 2764], 5000: [2320, 2493, 2673, 2858, 3051], 6000: [2564, 2755, 2953, 3159, 3371], 7000: [2837, 3048, 3267, 3494, 3729], 8000: [3142, 3376, 3619, 3871, 4131], 9000: [3485, 3744, 4013, 4293, 4581], 10000: [3870, 4158, 4457, 4767, 5088] }, 2900: { 0: [971, 1043, 1118, 1195, 1275], 1000: [1066, 1148, 1228, 1313, 1401], 2000: [1173, 1260, 1351, 1444, 1541], 3000: [1292, 1388, 1487, 1590, 1697], 4000: [1424, 1530, 1639, 1753, 1871], 5000: [1571, 1688, 1809, 1935, 2065], 6000: [1736, 1865, 1999, 2138, 2281], 7000: [1920, 2063, 2211, 2365, 2523], 8000: [2127, 2285, 2450, 2619, 2795], 9000: [2359, 2534, 2716, 2904, 3099], 10000: [2619, 2814, 3016, 3225, 3441] } } },
            landing: { altitudes: [0, 1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000], temps: [0, 10, 20, 30, 40], groundRoll: { 0: [1082, 1121, 1161, 1200, 1240], 1000: [1122, 1163, 1204, 1245, 1286], 2000: [1163, 1206, 1248, 1291, 1334], 3000: [1207, 1251, 1295, 1339, 1384], 4000: [1252, 1298, 1344, 1390, 1436], 5000: [1300, 1348, 1395, 1443, 1490], 6000: [1350, 1399, 1449, 1498, 1547], 7000: [1402, 1453, 1504, 1558, 1607], 8000: [1456, 1509, 1563, 1616, 1669], 9000: [1513, 1569, 1624, 1679, 1735], 10000: [1573, 1630, 1688, 1746, 1803] }, totalDist: { 0: [2262, 2316, 2372, 2428, 2485], 1000: [2317, 2374, 2433, 2492, 2551], 2000: [2375, 2436, 2497, 2559, 2621], 3000: [2437, 2501, 2565, 2630, 2696], 4000: [2503, 2569, 2637, 2705, 2774], 5000: [2572, 2642, 2713, 2785, 2857], 6000: [2645, 2719, 2794, 2869, 2945], 7000: [2723, 2800, 2879, 2958, 3038], 8000: [2805, 2887, 2969, 3052, 3136], 9000: [2892, 2978, 3064, 3152, 3240], 10000: [2984, 3074, 3165, 3257, 3350] } },
            takeoffclimb: { altitudes: [0, 2000, 4000, 6000, 8000, 10000], temps: [-20, 0, 20, 40], weights: [3400, 2900], data: { 3400: { 0: [1326, 1317, 1300, 1277], 2000: [1214, 1200, 1179, 1153], 4000: [1100, 1082, 1057, 1028], 6000: [985, 962, 934, 901], 8000: [869, 842, 809, 774], 10000: [851, 719, 683, 644] }, 2900: { 0: [1646, 1638, 1621, 1598], 2000: [1518, 1505, 1484, 1457], 4000: [1389, 1371, 1346, 1316], 6000: [1259, 1236, 1207, 1172], 8000: [1128, 1100, 1066, 1028], 10000: [995, 962, 924, 883] } } },
            balked: { altitudes: [0, 2000, 4000, 6000, 8000, 10000], temps: [-20, 0, 20, 40], weights: [3400, 2900], data: { 3400: { 0: [996, 1035, 1057, 1067], 2000: [930, 959, 972, 971], 4000: [858, 876, 878, 867], 6000: [779, 784, 775, 752], 8000: [691, 683, 660, 623], 10000: [593, 571, 532, 478] }, 2900: { 0: [1268, 1318, 1348, 1363], 2000: [1195, 1233, 1252, 1255], 4000: [1115, 1146, 1148, 1137], 6000: [1026, 1037, 1030, 1007], 8000: [927, 923, 900, 861], 10000: [817, 796, 755, 696] } } }
        };
        const CFZJJ_DATA = CFYWI_DATA;

        const personnel = [
            { name: "Jago Stemberger", call: "JAGO", weight: null },
            { name: "Okan Bozik", call: "OKAN", weight: 190 },
            { name: "Onur Boy", call: "ONUR", weight: 180 },
            { name: "Abdullah Uysal", call: "ABDU", weight: 190 },
            { name: "Emrah Yasin Onder", call: "EMRA", weight: 198 },
            { name: "Oguzcan Korkmaz", call: "OGUZ", weight: 190 },
            { name: "Caglar Yakin", call: "CAGL", weight: 160 },
            { name: "Harun Akinci", call: "HARU", weight: 193 },
            { name: "Furkan Yusuf KILICER", call: "FURK", weight: 162 },
            { name: "Busra Naz Bozbey", call: "BURS", weight: 147 },
            { name: "Mustafa Furkan Tekle", call: "MUST", weight: 151 },
            { name: "Nazlican Gokdemir", call: "NAZL", weight: 163 },
            { name: "Tim DeGroot", call: "GROO", weight: 199 },
            { name: "Davide Pasquali", call: "PASQ", weight: 162 },
            { name: "Timo Benitz", call: "TIMO", weight: 145 },
            { name: "Sebastian Dewsnap", call: "DEWS", weight: 253 },
            { name: "Giorgio Clementi", call: "GIO", weight: 274 },
            { name: "Williams Grac", call: "GRC", weight: 143 },
            { name: "Alain Lacharite", call: "ALA", weight: 171 },
            { name: "Raphael Langumier", call: "LGR", weight: 160 },
            { name: "David Lohse", call: "LOH", weight: 200 },
            { name: "Stan Constantine", call: "STA", weight: 215 },
            { name: "Thiago Macedo", call: "TIO", weight: 178 },
            { name: "Alexandre Fiorenzano", call: "ALEX", weight: 172 },
            { name: "Sibte Gillani", call: "SIB", weight: 219 },
            { name: "Brendan Pierce", call: "BRE", weight: 170 },
            { name: "Bennett Leong", call: "BENN", weight: 195 },
            { name: "Sasa Dobrosavljevic", call: "SASA", weight: 155 },
            { name: "Cyril Gennari", call: "CYR", weight: 155 },
            { name: "Berni Csabai", call: "CHINGO", weight: 180 },
            { name: "Stephen Crockett", call: "CROC", weight: 230 },
            { name: "Carl Bertrand", call: "BER", weight: 180 },
            { name: "Mark Chivers", call: "CHIV", weight: 228 },
            { name: "Amit Alfia", call: "AMIT", weight: 170 },
            { name: "David Ostler", call: "OST", weight: null },
            { name: "Marc Dehm", call: "DEHM", weight: 194 },
            { name: "Martin Bosse", call: "BOS", weight: 180 },
            { name: "Alan Uehara", call: "UEH", weight: 153 },
            { name: "Henry Language", call: "HHL", weight: 181 },
            { name: "Guy Lynch", call: "GUY", weight: 230 },
            { name: "Sannie Xu", call: "SAN", weight: 135 },
            { name: "Vincent Clementi", call: "VIN", weight: 199 },
            { name: "Michael Mulquiney", call: "MULQ", weight: null },
            { name: "Vaughn Guigui", call: "GUI", weight: 180 },
            { name: "Warwick Nuttall", call: "WARW", weight: null },
            { name: "Mikko Koli", call: "MPK", weight: 209 },
            { name: "Jens Lundgreen-Nielsen", call: "JENS", weight: 164 },
            { name: "Daryl Lim", call: "LIM", weight: null },
            { name: "Steve Griffiths", call: "GRIF", weight: 175 },
            { name: "Peter Kosogorin", call: "KOSO", weight: null },
            { name: "Soner Ozer", call: "OZER", weight: 160 },
            { name: "Mert Salih", call: "SALI", weight: 214 },
            { name: "Korkmaz Caner", call: "CANE", weight: 209 },
            { name: "Calaya Corneli", call: "CALA", weight: 97 },
            { name: "Darcy Lonergran", call: "DARC", weight: null },
            { name: "Cody Hansen", call: "CODY", weight: 160 },
            { name: "Daniele Trozzi", call: "DANI", weight: 230 },
            { name: "Lavpreet Sharma", call: "SHAR", weight: 219 },
            { name: "Ryan Munro", call: "MUNR", weight: 223 },
            { name: "Todd Wilson", call: "WILS", weight: 194 },
            { name: "Atish Moudgil", call: "MOUZ", weight: 190 },
            { name: "Write Weight Manually", call: "GUEST", weight: null, isManual: true }
        ];

        const aircraftDatabase = {
            CGRAS: CGRAS_DATA,
            CGZSN: CGZSN_DATA,
            CFYWI: CFYWI_DATA,
            CFZJJ: CFZJJ_DATA,
            personnel: personnel,
            fleet: [
                { call: "11", type: "Bell 206", reg: "C-FTSV", category: "Rotary Wing" },
                { call: "12", type: "S76", reg: "C-FETU", category: "Rotary Wing" },
                { call: "14", type: "Bo105", reg: "C-GGGM", category: "Rotary Wing" },
                { call: "15", type: "AS355", reg: "C-GOHA", category: "Rotary Wing" },
                { call: "17", type: "S76", reg: "C-FXGQ", category: "Rotary Wing" },
                { call: "20", type: "IAR Brasov", reg: "C-FPIU", category: "Fixed Wing" },
                { call: "21", type: "Cirrus SR22", reg: "C-FYWI", category: "Fixed Wing" },
                { call: "22", type: "Cirrus SR22", reg: "C-FZJJ", category: "Fixed Wing" },
                { call: "23", type: "SU29", reg: "C-FSSU", category: "Fixed Wing" },
                { call: "24", type: "Long EZ", reg: "C-GZEF", category: "Fixed Wing" },
                { call: "25", type: "Long EZ", reg: "C-GMJH", category: "Fixed Wing" },
                { call: "26", type: "C414", reg: "C-FIYQ", category: "Fixed Wing" },
                { call: "27", type: "Cessna 340", reg: "C-GRAS", category: "Fixed Wing" },
                { call: "28", type: "Cessna 340", reg: "C-GZSN", category: "Fixed Wing" },
                { call: "30", type: "Grumman Hu 16", reg: "N7025J", category: "Fixed Wing" },
                { call: "35", type: "L29", reg: "C-FLVB", category: "Fixed Wing" },
                { call: "36", type: "L29", reg: "C-FXZI", category: "Fixed Wing" },
                { call: "37", type: "Hunter", reg: "C-GHHR", category: "Fixed Wing" },
                { call: "38", type: "L39", reg: "C-GTOZ", category: "Fixed Wing" },
                { call: "40", type: "L39", reg: "C-GOZA", category: "Fixed Wing" },
                { call: "41", type: "L39", reg: "C-FDYT", category: "Fixed Wing" },
                { call: "42", type: "L39", reg: "C-GFNO", category: "Fixed Wing" },
                { call: "43", type: "L39", reg: "C-GFNJ", category: "Fixed Wing" },
                { call: "44", type: "L39", reg: "C-GFNK", category: "Fixed Wing" },
                { call: "45", type: "L39", reg: "C-GIBH", category: "Fixed Wing" },
                { call: "46", type: "L39", reg: "C-FDYQ", category: "Fixed Wing" },
                { call: "47", type: "L39", reg: "C-FDYR", category: "Fixed Wing" }
            ]
        };

        function interpolate(x, x0, x1, y0, y1) {
            if (x1 === x0) return y0;
            return y0 + (x - x0) * (y1 - y0) / (x1 - x0);
        }

        function bilinearInterpolate(altitude, temp, altitudes, temps, dataMatrix) {
            let altIdx0 = 0, altIdx1 = 0;
            for (let i = 0; i < altitudes.length - 1; i++) {
                if (altitude >= altitudes[i] && altitude <= altitudes[i + 1]) {
                    altIdx0 = i; altIdx1 = i + 1; break;
                }
            }
            if (altitude < altitudes[0]) { altIdx0 = 0; altIdx1 = 1; }
            if (altitude > altitudes[altitudes.length - 1]) { altIdx0 = altitudes.length - 2; altIdx1 = altitudes.length - 1; }

            let tempIdx0 = 0, tempIdx1 = 0;
            for (let i = 0; i < temps.length - 1; i++) {
                if (temp >= temps[i] && temp <= temps[i + 1]) {
                    tempIdx0 = i; tempIdx1 = i + 1; break;
                }
            }
            if (temp < temps[0]) { tempIdx0 = 0; tempIdx1 = 1; }
            if (temp > temps[temps.length - 1]) { tempIdx0 = temps.length - 2; tempIdx1 = temps.length - 1; }

            const alt0 = altitudes[altIdx0], alt1 = altitudes[altIdx1];
            const temp0 = temps[tempIdx0], temp1 = temps[tempIdx1];
            const val00 = dataMatrix[altitudes[altIdx0]][tempIdx0];
            const val01 = dataMatrix[altitudes[altIdx0]][tempIdx1];
            const val10 = dataMatrix[altitudes[altIdx1]][tempIdx0];
            const val11 = dataMatrix[altitudes[altIdx1]][tempIdx1];
            const valTemp0 = interpolate(altitude, alt0, alt1, val00, val10);
            const valTemp1 = interpolate(altitude, alt0, alt1, val01, val11);
            return interpolate(temp, temp0, temp1, valTemp0, valTemp1);
        }

        function render() {
            const root = document.getElementById('root');
            if (state.screen === 'aircraft') {
                root.innerHTML = `
                    <div class="flex-center">
                        <div class="text-center" style="position: relative;">
                            <a href="mailto:furkan.kilicer@itpscanada.com?subject=ITPS App Feedback/Bug Report" class="btn-feedback">
                                üìß Suggestion or Bug Report?
                            </a>
                            <div class="split-container">
                                <h2 class="split-title">
                                    Flight Test Tools
                                    <span>Flight Test Tools</span>
                                    <span>Flight Test Tools</span>
                                    <span>Bad juju</span>
                                </h2>
                            </div>
                            <p style="margin-bottom: 0.75rem; opacity: 0.7; font-size: 0.9rem;">Select a module</p>
                            <div class="dashboard-grid">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, rgba(37, 99, 235, 0.6), rgba(30, 64, 175, 0.8));" onclick="startWeather()">
                                    <span class="btn-icon">üì°</span>
                                    <span class="btn-text">Weather</span>
                                </button>
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, rgba(124, 45, 18, 0.6), rgba(68, 25, 11, 0.8));" onclick="state.screen = 'wbmenu'; render()">
                                    <span class="btn-icon">‚öñÔ∏è</span>
                                    <span class="btn-text">Weight & Balance</span>
                                </button>
                                
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, rgba(31, 41, 55, 0.6), rgba(17, 24, 39, 0.8));" onclick="window.location.href = 'flight_test_master.html'">
                                    <span class="btn-icon">‚úàÔ∏è</span>
                                    <span class="btn-text">Flight Test Master</span>
                                </button>

                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, rgba(6, 78, 59, 0.6), rgba(6, 95, 70, 0.8));" onclick="state.screen = 'documents'; render()">
                                    <span class="btn-icon">üìÑ</span>
                                    <span class="btn-text">Documents</span>
                                </button>
                                 <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, rgba(153, 27, 27, 0.6), rgba(127, 29, 29, 0.8));" onclick="window.open('https://portal.itpscanada.com/dashboard/my_calendar', '_blank')">
                                    <span class="btn-icon">üåê</span>
                                    <span class="btn-text">ITPS Portal</span>
                                </button>
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #34d399, #059669); grid-column: span 1;" onclick="window.open('https://www.windy.com/43.030/-81.156/meteogram?43.030,-81.156,9', '_blank')">
                                    <span class="btn-icon">üåê</span>
                                    <span class="btn-text">Windy</span>
                                </button>
                            </div>

                            <div class="disclaimer-card">
                                <div class="disclaimer-title">‚ö†Ô∏è Disclaimer</div>
                                For supportive use only. Verify all values with official POH/AFM. The owner assumes no liability for errors or outcomes.
                            </div>
                            <div style="margin-top: 1.5rem; text-align: center;">
                                <h1 style="font-size: 0.625rem; font-weight: 900; font-family: 'Montserrat', sans-serif; color: #f8fafc; text-shadow: 0 0 10px rgba(255, 255, 255, 0.3); margin: 0; text-transform: uppercase; letter-spacing: 0.1em;">Developed by Furkan Yusuf Kƒ±lƒ±√ßer</h1>
                            </div>
                            <div style="color: #64748b; font-size: 0.75rem; margin-top: 0.5rem; display: flex; justify-content: center; gap: 1rem;">
                                <span>Version 2.0</span>
                                <span>Last Updated: 13/02/2026</span>
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.screen === 'wbmenu') {
                renderWBMenu();
            } else if (state.screen === 'wb') {
                renderWB();
            } else if (state.screen === 'weather') {
                renderWeather();
            } else if (state.screen === 'runway') {
                renderRunway();
            } else if (state.screen === 'calculator') {
                renderCalculator();
            } else if (state.screen === 'fleet') {
                renderFleet();
            } else if (state.screen === 'documents') {
                renderDocuments();
            } else if (state.screen === 'flightTestMaster') {
                renderFlightTestMaster();
            }
        }

        function selectAircraft(aircraft) {
            state.screen = 'runway';
            state.selectedAircraft = aircraft;
            state.runwayMode = null;
            state.allResults = null;
            state.weights = {};
            render();
            saveState();
        }

        function startWB() {
            state.screen = 'wb';
            render();
            saveState();
        }

        function goBackHome() {
            state.screen = 'aircraft';
            state.selectedAircraft = null;
            state.weatherData = null;
            render();
            saveState();
        }

        function startWeather() {
            state.screen = 'weather';
            fetchWeather();
            render();
            saveState();
        }

        async function fetchWeather() {
            state.weatherLoading = true;
            render();
            const stArray = ['CYXU', 'CYSA', 'CYKF', 'CYQS', 'CYCE', 'CYTB'];
            const stationStr = stArray.join(',');
            const now = new Date().getTime();
            console.log("üöÄ Starting Weather Fetch...");

            // Use Promise.race for faster response - whichever proxy responds first wins
            async function fastFetch(url) {
                const targetUrl = url + (url.includes('?') ? '&' : '?') + `_cb=${now}`;

                // Multiple proxy options
                const proxyUrls = [
                    `https://corsproxy.io/?${encodeURIComponent(targetUrl)}`,
                    `https://api.allorigins.win/raw?url=${encodeURIComponent(targetUrl)}&_=${now}`,
                    `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(targetUrl)}`
                ];

                const fetchWithTimeout = (pxUrl, timeout = 3000) => {
                    return new Promise((resolve, reject) => {
                        const controller = new AbortController();
                        const timer = setTimeout(() => {
                            controller.abort();
                            reject(new Error('Timeout'));
                        }, timeout);

                        fetch(pxUrl, {
                            signal: controller.signal,
                            cache: 'no-store'
                        })
                            .then(res => {
                                clearTimeout(timer);
                                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                                return res.text();
                            })
                            .then(text => {
                                if (!text || text.includes('403 Forbidden') || text.includes('Access Denied')) {
                                    throw new Error('Blocked');
                                }
                                // Handle allorigins JSON wrapper
                                if (pxUrl.includes('allorigins.win')) {
                                    try {
                                        const json = JSON.parse(text);
                                        resolve(json.contents || text);
                                    } catch (e) {
                                        resolve(text);
                                    }
                                } else {
                                    resolve(text);
                                }
                            })
                            .catch(err => {
                                clearTimeout(timer);
                                reject(err);
                            });
                    });
                };

                // Try all proxies in parallel, return the first success
                const promises = proxyUrls.map(url => fetchWithTimeout(url));

                try {
                    const result = await Promise.any(promises);
                    try {
                        return JSON.parse(result);
                    } catch (e) {
                        return result;
                    }
                } catch (e) {
                    console.error("All proxies failed:", e);
                    return null;
                }
            }

            try {
                console.log('üåê Fetching METAR and TAF...');

                // Fetch both in parallel
                const [metarData, tafData] = await Promise.all([
                    fastFetch(`https://aviationweather.gov/api/data/metar?ids=${stationStr}&format=json&decoded=true`),
                    fastFetch(`https://aviationweather.gov/api/data/taf?ids=${stationStr}&format=json&decoded=true`)
                ]);

                console.log('üìä METAR:', Array.isArray(metarData) ? metarData.length : 'invalid');
                console.log('üìä TAF:', Array.isArray(tafData) ? tafData.length : 'invalid');

                const metars = Array.isArray(metarData) ? metarData : [];
                const tafs = Array.isArray(tafData) ? tafData : [];

                if (metars.length === 0 && tafs.length === 0) {
                    state.weatherData = "No weather data available. Please try again.";
                } else {
                    state.weatherData = { metars, tafs };
                    state.lastUpdated = new Date().toLocaleTimeString();
                }
            } catch (error) {
                console.error("üî• Error:", error);
                state.weatherData = "Error: " + error.message;
            } finally {
                state.weatherLoading = false;
                render();
            }
        }


        function renderWeather() {
            const root = document.getElementById('root');
            let content = '';

            if (state.weatherLoading) {
                root.innerHTML = `
                    <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 1.5rem;">
                        <div class="text-center" style="color: white; font-size: 1.25rem;">üì° Fetching...</div>
                        <button class="btn-back" onclick="goBackHome()" style="position: static;">‚Üê Stop & Back Home</button>
                    </div>
                `;
                return;
            } else if (typeof state.weatherData === 'string') {
                root.innerHTML = `
                    <div class="container" style="padding-top: 2rem;">
                        <button class="btn-back" onclick="goBackHome()">‚Üê Back Home</button>
                        <div class="results" style="background: #fef2f2; border-color: #ef4444; color: #991b1b; margin-top: 1rem;">‚ö†Ô∏è ${state.weatherData}</div>
                        <button class="btn-primary" style="margin-top: 1rem;" onclick="fetchWeather()">üîÑ Try Again</button>
                    </div>
                `;
                return;
            } else if (state.weatherData) {
                const stationsList = ['CYXU', 'CYSA', 'CYKF', 'CYQS', 'CYCE', 'CYTB'];

                const getRunwayWinds = (windDir, windSpeed) => {
                    if (windDir === null || windSpeed === null || typeof windDir === 'undefined' || typeof windSpeed === 'undefined') return null;

                    // METAR is True, Runways are Magnetic. 
                    // CYXU Magnetic Variation is approx 9¬∞ West.
                    // To get Magnetic: True + 9 (West is Best/Plus)
                    const magWindDir = (windDir + 9) % 360;

                    const runways = [
                        { id: '15', dir: 151 },
                        { id: '33', dir: 331 },
                        { id: '09', dir: 88 },
                        { id: '27', dir: 268 }
                    ];
                    return runways.map(r => {
                        const diff = (magWindDir - r.dir + 360) % 360;
                        const rad = diff * Math.PI / 180;
                        const head = Math.round(windSpeed * Math.cos(rad));
                        const cross = Math.round(windSpeed * Math.sin(rad));

                        // Crosswind Side: 
                        // If diff is 0-180, wind is from the RIGHT of the runway heading.
                        // If diff is 180-360, wind is from the LEFT.
                        const isFromRight = diff > 0 && diff < 180;

                        return {
                            id: r.id,
                            head: head,
                            cross: Math.abs(cross),
                            side: cross === 0 ? '' : (isFromRight ? 'Right' : 'Left'),
                            headArrow: head >= 0 ? '‚Üì' : '‚Üë', // ‚Üì = wind hitting nose (headwind), ‚Üë = wind from behind (tailwind)
                            crossArrow: cross === 0 ? '' : (isFromRight ? '‚Üê' : '‚Üí'), // ‚Üê = blowing from right to left, ‚Üí = blowing from left to right
                            favorable: head >= 0
                        };
                    });
                };

                const decodeClouds = (clouds) => {
                    if (!clouds || clouds.length === 0) return 'Clear skies';
                    const mapping = {
                        'SKC': 'Clear skies', 'CLR': 'Clear skies', 'FEW': 'Few clouds', 'SCT': 'Scattered clouds',
                        'BKN': 'Broken clouds', 'OVC': 'Overcast clouds', 'OVX': 'Indefinite ceiling',
                        'NSC': 'No significant clouds', 'CAVOK': 'Cloud and Visibility OK'
                    };
                    return clouds.map(c => {
                        const level = c.base || 0;
                        const cover = c.cover;
                        const desc = mapping[cover] || cover;

                        // If it's a clear code, or indefinite at 0ft, just return the description
                        if (['SKC', 'CLR', 'NSC', 'CAVOK'].includes(cover) || (cover === 'OVX' && level === 0)) {
                            return desc;
                        }

                        const style = level < 1000 ? 'color: #dc2626; font-weight: 800;' : (level < 3000 ? 'color: #2563eb; font-weight: 700;' : '');
                        return `<span style="${style}">${desc} at ${level} ft</span>`;
                    }).join(', ');
                };

                const getTimeAgo = (iso) => {
                    if (!iso) return '';
                    const diffMs = new Date().getTime() - new Date(iso).getTime();
                    const diffMin = Math.floor(diffMs / 60000);
                    if (diffMin < 1) return 'JUST NOW';
                    if (diffMin < 60) return `${diffMin} min ago`;
                    const diffHrs = Math.floor(diffMin / 60);
                    if (diffHrs < 24) return `${diffHrs}h ${diffMin % 60}m ago`;
                    return `${Math.floor(diffHrs / 24)}d ago`;
                };

                const decodeWeather = (wx) => {
                    if (!wx) return '';
                    const codes = {
                        'SN': 'Snow', 'RA': 'Rain', 'DZ': 'Drizzle', 'SH': 'Showers', 'TS': 'Thunderstorms',
                        'FG': 'Fog', 'BR': 'Mist', 'HZ': 'Haze', 'FU': 'Smoke', 'BL': 'Blowing', 'DU': 'Dust',
                        'SQ': 'Squalls', 'FC': 'Funnel Cloud', 'GR': 'Hail', 'PL': 'Ice Pellets', 'FZ': 'Freezing',
                        'VC': 'In the vicinity', 'MI': 'Shallow', 'PR': 'Partial', 'DR': 'Low drifting'
                    };
                    let result = wx.startsWith('-') ? 'Light ' : (wx.startsWith('+') ? 'Heavy ' : '');
                    const cleanWx = wx.replace(/[+-]/g, '');
                    const parts = cleanWx.match(/.{1,2}/g) || [];
                    result += parts.map(p => codes[p] || p).join(' ');
                    return result;
                };

                const decodeMetar = (m) => {
                    if (!m) return 'No data available.';
                    const wind = m.wspd === 0 ? 'Calm' : `from the ${m.wdir}¬∞ at <b>${m.wspd} knots</b>${m.wgst ? ` (Gusting to ${m.wgst} kt)` : ''}`;
                    const vis = m.visib === "6+" ? 'More than 6 miles' : `<b>${m.visib} miles</b>`;

                    const clouds = decodeClouds(m.clouds);
                    const wx = decodeWeather(m.wxString);
                    const lowestCloud = m.clouds && m.clouds.length > 0 ? Math.min(...m.clouds.map(c => c.base || 10000)) : 10000;
                    const visibilityVal = parseFloat(m.visib) || 10;

                    const category = (lowestCloud < 1000 || visibilityVal < 3) ? 'IFR' : (lowestCloud <= 3000 || visibilityVal <= 5 ? 'MVFR' : 'VFR');
                    const catColor = category === 'VFR' ? '#16a34a' : (category === 'MVFR' ? '#2563eb' : '#dc2626');

                    const d = new Date(m.reportTime);
                    const hms = d.getUTCHours().toString().padStart(2, '0') + d.getUTCMinutes().toString().padStart(2, '0');
                    const fullTimeStr = `${hms} UTC ${d.getUTCDate()} ${d.toLocaleDateString('en-GB', { weekday: 'short', month: 'short', year: 'numeric', timeZone: 'UTC' })}`;
                    const ageStr = getTimeAgo(m.reportTime);

                    // Convert hPa to inHg: 1017.4 -> 30.04
                    const inHg = m.altim ? (m.altim * 0.02953).toFixed(2) : '---';

                    return `
                        <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom: 0.5rem; border-bottom: 1px solid rgba(0,0,0,0.05); padding-bottom: 0.4rem;">
                            <div style="display:inline-flex; flex-direction: column; gap: 2px;">
                                <div style="display:inline-block; padding: 2px 10px; border-radius: 4px; background: ${catColor}; color: white; font-size: 0.8rem; font-weight: 950; box-shadow: 0 1px 2px rgba(0,0,0,0.1); width: fit-content;">${category}</div>
                                <div style="font-size: 0.6rem; font-weight: 850; color: #dc2626; background: #fee2e2; padding: 1px 6px; border-radius: 3px; border: 1px solid #fecaca; width: fit-content;">‚è±Ô∏è ${ageStr}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 0.7rem; font-weight: 900; color: #1e293b; margin-bottom: 1px;">${m.name || 'Station Data'}</div>
                                <div style="font-size: 0.55rem; font-weight: 800; color: #94a3b8; text-transform: uppercase;">Conditions at:</div>
                                <div style="font-size: 0.7rem; font-weight: 800; color: #475569;">${fullTimeStr}</div>
                            </div>
                        </div>
                        <div style="font-size: 0.88rem; line-height: 1.4; color: #1e293b;">
                            <div style="margin-bottom: 2px;"><b>Wind</b>: ${wind}</div>
                            <div style="margin-bottom: 2px;"><b>Visibility</b>: ${vis}</div>
                            ${wx ? `<div style="margin-bottom: 2px;"><b>Weather</b>: <span style="background: #fef2f2; color: #be123c; padding: 0px 4px; border-radius: 3px; border: 1px solid #fee2e2; font-weight: 700;">${wx}</span></div>` : ''}
                            <div style="margin-bottom: 2px;"><b>Sky</b>: ${clouds}</div>
                            <div style="margin-bottom: 2px;"><b>Temp</b>: ${m.temp}¬∞C (Dew: ${m.dewp}¬∞C)</div>
                            <div style="margin-bottom: 0px;"><b>Altimeter</b>: ${m.altim} hPa (${inHg} inHg)</div>
                        </div>
                    `;
                };

                const decodeTaf = (t) => {
                    if (!t || !t.fcsts) return 'No forecast available.';

                    const pad = (n) => n.toString().padStart(2, '0');
                    const formatUtcFull = (iso) => {
                        if (!iso) return 'N/A';
                        const d = new Date(iso);
                        return `${pad(d.getUTCHours())}${pad(d.getUTCMinutes())}Z`;
                    };

                    const formatUtcDayTime = (iso) => {
                        if (!iso) return '';
                        const d = new Date(iso);
                        const day = d.toLocaleDateString('en-GB', { weekday: 'short', timeZone: 'UTC' });
                        const time = `${pad(d.getUTCHours())}${pad(d.getUTCMinutes())}Z`;
                        return `${day} ${time}`;
                    };

                    const issueTime = formatUtcFull(t.issueTime);
                    const issueAge = getTimeAgo(t.issueTime);

                    const header = `
                        <div style="margin-bottom: 0.5rem; padding-bottom: 0.4rem; border-bottom: 1.5px solid #ccfbf1; display: flex; justify-content: space-between; align-items: center;">
                            <div style="font-size: 0.7rem; font-weight: 850; color: #065f46;">
                                üìÖ <b>Issued:</b> ${issueTime} <span style="margin-left:6px; color:#047857; background:#defcf5; padding:1px 6px; border-radius:3px; font-size: 0.6rem;">‚è±Ô∏è ${issueAge}</span>
                            </div>
                            <div style="font-size: 0.75rem; font-weight: 950; color: #064e1b; background: #ccfbf1; padding: 2px 8px; border-radius: 4px;">${t.icaoId}</div>
                        </div>
                    `;

                    const changeMappings = {
                        'FM': 'Starting',
                        'BECMG': 'Becoming',
                        'TEMPO': 'Temporary',
                        'PROB': 'Prob'
                    };

                    const forecasts = t.fcsts.map(f => {
                        const fromTime = formatUtcDayTime(f.timeFrom);
                        const toTime = (f.timeTo && f.timeTo !== f.timeFrom) ? ' ‚Üí ' + formatUtcDayTime(f.timeTo) : '';

                        const technicalType = f.fcstChange || 'Basic';
                        const humanType = changeMappings[technicalType] || technicalType;

                        const wind = f.wspd === null ? 'Same' : (f.wspd === 0 ? 'Calm' : `<b>${f.wspd}kt</b> @ ${f.wdir}¬∞${f.wgst ? ` (G${f.wgst}kt)` : ''}`);
                        const vis = f.visib === null ? 'Same' : (f.visib === "6+" ? '>6SM' : `<b>${f.visib}SM</b>`);

                        const clouds = decodeClouds(f.clouds);
                        const wx = decodeWeather(f.wxString);
                        return `<div style="padding: 4px 0; border-bottom: 1px dashed rgba(15, 23, 42, 0.08); font-size: 0.8rem; line-height: 1.25;">
                                    <div style="margin-bottom: 2px; display: flex; align-items: center; gap: 6px;">
                                        <span style="background: #1e293b; color: white; padding: 0px 4px; border-radius: 2px; font-weight: 950; font-size: 0.55rem; text-transform: uppercase;">${humanType}</span>
                                        <span style="color: #475569; font-weight: 800; font-size: 0.65rem;">${fromTime}${toTime}</span>
                                    </div>
                                    <div style="color: #1e293b; padding-left: 6px; border-left: 2px solid #5eead4; display: grid; grid-template-columns: 1.1fr 1fr; gap: 0px 6px;">
                                        <div><b>Wind</b>: ${wind}</div>
                                        <div><b>Vis</b>: ${vis}${wx ? ` <b>(${wx})</b>` : ''}</div>
                                        <div style="grid-column: span 2; color: #475569; font-size: 0.7rem;"><b>Sky</b>: ${clouds}</div>
                                    </div>
                                </div>`;
                    }).join('');

                    return header + forecasts;
                };


                const notamUrl = "https://notam.ca/?point=CYXU%7Csite%7C-81.151%2C43.033&point=CYSA%7Csite%7C-80.934%2C43.416&point=CYKF%7Csite%7C-80.379%2C43.461&point=CYQS%7Csite%7C-81.110%2C42.770&point=CYCE%7Csite%7C-81.506%2C43.286&point=CYTB%7Csite%7C-80.747%2C42.926";
                const awcUrl = "https://aviationweather.gov/data/metar/?ids=CYXU%2CCYSA%2CCYKF%2CCYQS%2CCYCE%2CCYTB&taf=1";
                const sidebarLeft = state.sidebarHidden ? '' : `
                    <div style="position: fixed; left: 0.5rem; top: 10%; width: 70px; min-height: 48px; background: rgba(15, 23, 42, 0.4); backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; padding: 0.6rem; color: white; z-index: 1000; box-shadow: 0 8px 32px rgba(0,0,0,0.3); display: flex; flex-direction: column; gap: 0.6rem; overflow: hidden; transition: all 0.3s ease;">
                        <a href="${notamUrl}" target="_blank" style="text-decoration: none; color: white; display: flex; flex-direction: column; align-items: center; gap: 4px; background: #7c3aed; padding: 10px 4px; border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4); transform: scale(1.1); margin-bottom: 5px;">
                            <span style="font-size: 1.5rem;">üìú</span>
                            <span style="font-size: 0.5rem; font-weight: 950; text-transform: uppercase; letter-spacing: 0.05em; text-align: center;">NOTAMs</span>
                        </a>

                        <a href="${awcUrl}" target="_blank" style="text-decoration: none; color: white; display: flex; flex-direction: column; align-items: center; gap: 4px; background: #0ea5e9; padding: 10px 4px; border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4); transform: scale(1.1); margin-bottom: 5px;">
                            <span style="font-size: 1.5rem;">üõ°Ô∏è</span>
                            <span style="font-size: 0.5rem; font-weight: 950; text-transform: uppercase; letter-spacing: 0.05em; text-align: center;">Check METAR&TAF</span>
                        </a>
                        
                        ${state.bananaMode ? `
                            <div style="font-weight: 950; font-size: 0.55rem; color: rgba(255,255,255,0.5); text-align: center; letter-spacing: 0.05em; margin-bottom: 0.4rem; margin-top: 0.6rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 0.5rem;">‚òÅÔ∏è RISK GUIDE</div>
                            <div style="display: flex; flex-direction: column; gap: 0.8rem;">
                                <!-- Fog/OVX -->
                                <div style="display: flex; flex-direction: column; gap: 1px; border-left: 3px solid #dc2626; padding-left: 6px;">
                                    <b style="font-size: 0.75rem; color: #fca5a5;">FG / OVX</b>
                                    <span style="font-size: 0.55rem; color: #f87171; line-height: 1.1; font-weight: 700;">CRITICAL:<br>Hidden Sky</span>
                                </div>
                                <!-- Overcast -->
                                <div style="display: flex; flex-direction: column; gap: 1px; border-left: 3px solid #ef4444; padding-left: 6px;">
                                    <b style="font-size: 0.75rem; color: #fecaca;">OVC</b>
                                    <span style="font-size: 0.55rem; color: #fca5a5; line-height: 1.1; font-weight: 600;">HIGH RISK:<br>Full Cover</span>
                                </div>
                                <!-- Broken -->
                                <div style="display: flex; flex-direction: column; gap: 1px; border-left: 3px solid #3b82f6; padding-left: 6px;">
                                    <b style="font-size: 0.75rem; color: #bfdbfe;">BKN</b>
                                    <span style="font-size: 0.55rem; color: #93c5fd; line-height: 1.1;">MEDIUM:<br>Mostly Cloudy</span>
                                </div>
                                <!-- Scattered -->
                                <div style="display: flex; flex-direction: column; gap: 1px; border-left: 3px solid #0ea5e9; padding-left: 6px;">
                                    <b style="font-size: 0.75rem; color: #bae6fd;">SCT</b>
                                    <span style="font-size: 0.55rem; color: #7dd3fc; line-height: 1.1;">LOW:<br>Scattered</span>
                                </div>
                                <!-- Few -->
                                <div style="display: flex; flex-direction: column; gap: 1px; border-left: 3px solid #22c55e; padding-left: 6px;">
                                    <b style="font-size: 0.75rem; color: #bbf7d0;">FEW</b>
                                    <span style="font-size: 0.55rem; color: #86efac; line-height: 1.1;">MINIMAL:<br>Few Patches</span>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;

                const sidebarRight = (state.sidebarHidden || !state.bananaMode) ? '' : `
                    <div style="position: fixed; right: 0.5rem; top: 10%; width: 190px; background: rgba(255,255,255,0.08); backdrop-filter: blur(10px); padding: 0.85rem; border-radius: 1rem; border: 1px solid rgba(255,255,255,0.15); font-size: 0.75rem; color: #f8fafc; box-shadow: 0 12px 24px rgba(0,0,0,0.4); z-index: 1000;">
                        <div style="font-weight: 950; color: #f1f5f9; margin-bottom: 0.65rem; text-transform: uppercase; letter-spacing: 0.1em; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 0.4rem; font-size: 0.75rem; text-align: center;">üö© CATEGORIES</div>
                            <div style="display: flex; align-items: flex-start; gap: 0.5rem; background: rgba(255,255,255,0.05); padding: 0.5rem; border-radius: 0.75rem; margin-bottom: 0.5rem;">
                                <div style="width: 14px; height: 14px; background: #22c55e; border-radius: 3px; margin-top: 2px; flex-shrink: 0;"></div>
                                <div><b style="color: white; font-size: 0.85rem;">VFR</b><div style="font-size: 0.7rem; color: #cbd5e1; margin-top: 1px;">Ceil > 3k', Vis > 5m</div></div>
                            </div>
                            <div style="display: flex; align-items: flex-start; gap: 0.5rem; background: rgba(255,255,255,0.05); padding: 0.5rem; border-radius: 0.75rem; margin-bottom: 0.5rem;">
                                <div style="width: 14px; height: 14px; background: #3b82f6; border-radius: 3px; margin-top: 2px; flex-shrink: 0;"></div>
                                <div><b style="color: white; font-size: 0.85rem;">MVFR</b><div style="font-size: 0.7rem; color: #cbd5e1; margin-top: 1px;">Ceil 1-3k', Vis 3-5m</div></div>
                            </div>
                            <div style="display: flex; align-items: flex-start; gap: 0.5rem; background: rgba(255,255,255,0.05); padding: 0.5rem; border-radius: 0.75rem; margin-bottom: 0.5rem;">
                                <div style="width: 14px; height: 14px; background: #ef4444; border-radius: 3px; margin-top: 2px; flex-shrink: 0;"></div>
                                <div><b style="color: white; font-size: 0.85rem;">IFR</b><div style="font-size: 0.7rem; color: #cbd5e1; margin-top: 1px;">Ceil < 1k', Vis < 3m</div></div>
                            </div>
                            <div style="color: #94a3b8; font-size: 0.65rem; line-height: 1.2; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 0.5rem; text-align: center;">* Ceiling: Lowest BKN/OVC.</div>
                    </div>
                `;

                root.innerHTML = `
                    <div style="min-height: 100vh; position: relative; width: 100%; overflow-x: hidden; padding: 1.5rem 0;">
                        ${sidebarLeft}
                        ${sidebarRight}
                        <div class="container" style="position: relative; z-index: 10;">
                            <button class="btn-back" onclick="goBackHome()">‚Üê Back Home</button>
                            <div class="card" style="box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.98); padding: 1.5rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.25rem; flex-wrap: wrap; gap: 1rem;">
                                    <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 0.2rem;">
                                        <h2 style="margin: 0; color: #0f172a; font-size: 1.5rem; font-weight: 900; letter-spacing: -0.04em;">üå§Ô∏è Flight Test Tools</h2>
                                        <div style="font-size: 0.65rem; font-weight: 800; color: #64748b; background: #f1f5f9; padding: 2px 8px; border-radius: 4px; border: 1px solid #e2e8f0;">üïí Version 2.0 ‚Ä¢ Updated: 12/02 ‚Ä¢ Refresh: ${state.lastUpdated || 'Never'}</div>
                                    </div>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button class="btn-primary" style="width: auto; padding: 0.45rem 1rem; margin: 0; font-size: 0.85rem; font-weight: 800; border-radius: 0.6rem;" onclick="state.bananaMode = !state.bananaMode; render()">
                                            ${state.bananaMode ? 'üëë Princess Mode' : "üçå I'm not Pilot I want Banana Mode"}
                                        </button>
                                        <button class="btn-primary" style="width: auto; padding: 0.45rem 1rem; margin: 0; font-size: 0.85rem; font-weight: 800; border-radius: 0.6rem;" onclick="state.sidebarHidden = !state.sidebarHidden; render()">
                                            ${state.sidebarHidden ? 'üëÅÔ∏è Show Sidebars' : 'üôà Hide Sidebars'}
                                        </button>
                                        <button class="btn-primary" style="width: auto; padding: 0.45rem 1rem; margin: 0; font-size: 0.85rem; font-weight: 800; border-radius: 0.6rem;" onclick="window.open('https://www.windy.com/43.030/-81.156/meteogram?43.030,-81.156,9', '_blank')">
                                            üåê Windy
                                        </button>
                                        <button class="btn-primary" style="width: auto; padding: 0.45rem 1rem; margin: 0; font-size: 0.85rem; font-weight: 800; border-radius: 0.6rem;" onclick="fetchWeather()">üîÑ Refresh</button>
                                    </div>
                                </div>
                                

                                <div style="display: flex; flex-direction: column; gap: 2.5rem;">
                                    ${stationsList.map(st => {
                    const m = Array.isArray(state.weatherData?.metars) ? state.weatherData.metars.find(x => x.icaoId === st) : null;
                    const t = Array.isArray(state.weatherData?.tafs) ? state.weatherData.tafs.find(x => x.icaoId === st) : null;
                    return `
                                            <div class="module-result" style="margin: 0; padding: 1.25rem; border-left: 6px solid #3b82f6; background: #fafafa; border-radius: 0 0.85rem 0.85rem 0; box-shadow: 0 2px 8px rgba(0,0,0,0.03);">
                                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.6rem;">
                                                    <div style="font-weight: 950; color: #0f172a; font-size: 1.25rem; letter-spacing: -0.04em;">üìç ${st}</div>
                                                    ${st === 'CYXU' ? (() => {
                            const rw = getRunwayWinds(m?.wdir, m?.wspd);
                            if (!rw) return '';
                            return `<div style="display: flex; gap: 0.4rem; flex-wrap: wrap;">
                                                            ${rw.map(w => `
                                                                <div style="background: ${w.favorable ? '#f0fdf4' : '#fff1f2'}; border: 1px solid ${w.favorable ? '#10b981' : '#fecaca'}; padding: 0.25rem 0.6rem; border-radius: 0.5rem; font-size: 0.75rem; min-width: 95px; text-align: center;">
                                                                    <div style="font-weight: 900; color: ${w.favorable ? '#15803d' : '#be123c'}; border-bottom: 1px solid rgba(0,0,0,0.05); margin-bottom: 3px; font-size: 0.85rem; text-transform: uppercase;">RWY ${w.id}</div>
                                                                    <div style="display: flex; flex-direction: column; line-height: 1.3;">
                                                                        <span style="font-weight: 900; color: #1e293b;">${w.headArrow} ${Math.abs(w.head)} ${w.head >= 0 ? 'HEAD' : 'TAIL'}</span>
                                                                        <span style="color: #64748b; font-weight: 700;">${w.crossArrow} ${w.cross} ${w.side.charAt(0)}</span>
                                                                    </div>
                                                                </div>
                                                            `).join('')}
                                                        </div>`;
                        })() : ''}
                                                </div>
                                                
                                                <div style="margin-bottom: 1rem;">
                                                    <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 0.4rem;">
                                                        <div style="font-size: 0.75rem; font-weight: 900; color: #2563eb; text-transform: uppercase; letter-spacing: 0.1em;">üì° METAR</div>
                                                        <div style="font-size: 0.65rem; font-weight: 850; color: #dc2626; background: #fee2e2; padding: 1px 6px; border-radius: 4px; border: 1px solid #fecaca; margin-bottom: 2px;">‚è±Ô∏è ${getTimeAgo(m?.reportTime)}</div>
                                                    </div>
                                                    <div style="font-family: ${state.bananaMode ? 'inherit' : 'monospace'}; font-size: 0.85rem; color: #1e293b; background: #f8fafc; padding: 0.75rem; border-radius: 0.6rem; border: 1px solid #e2e8f0; line-height: 1.5;">${state.bananaMode ? decodeMetar(m) : (m ? m.rawOb.trim() : '[N/A]')}</div>
                                                </div>

                                                <div>
                                                    <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 0.4rem;">
                                                        <div style="font-size: 0.75rem; font-weight: 900; color: #059669; text-transform: uppercase; letter-spacing: 0.1em;">üìÖ TAF</div>
                                                        <div style="font-size: 0.65rem; font-weight: 850; color: #065f46; background: #defcf5; padding: 1px 6px; border-radius: 4px; border: 1px solid #ccfbf1; margin-bottom: 2px;">‚è±Ô∏è ${getTimeAgo(t?.issueTime)}</div>
                                                    </div>
                                                    <div style="font-family: ${state.bananaMode ? 'inherit' : 'monospace'}; font-size: 0.85rem; color: #064e3b; background: #f0fdf9; padding: 0.75rem; border-radius: 0.6rem; border: 1px solid #ccfbf1; white-space: pre-line; line-height: 1.5;">${state.bananaMode ? decodeTaf(t) : (t ? t.rawTAF.trim() : '[N/A]')}</div>
                                                </div>
                                            </div>
                                        `;
                }).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function updateWBField(field, value) {
            state.wb[field] = value;
            render();
            saveState();
        }

        function updateManualWeight(personId, weight) {
            state.wb.manualWeights[personId] = weight;
            render();
            saveState();
        }

        function updatePersonnelSearch(query) {
            state.personnelSearch = query;
            const listContainer = document.getElementById('personnel-list');
            if (listContainer) {
                listContainer.innerHTML = getPersonnelListHtml();
            } else {
                render();
            }
        }

        function getPersonnelListHtml() {
            return aircraftDatabase.personnel
                .slice()
                .filter(p => !p.isManual)
                .filter(p => p.name.toLowerCase().includes(state.personnelSearch.toLowerCase()) || p.call.toLowerCase().includes(state.personnelSearch.toLowerCase()))
                .sort((a, b) => a.name.localeCompare(b.name))
                .map(p => `
                        <div class="personnel-list-item">
                            <div class="personnel-info">
                                <span class="personnel-name">${p.name}</span>
                                <span class="personnel-weight">${p.weight !== null ? p.weight + ' lb' : '[N/A]'}</span>
                            </div>
                            <span class="personnel-call">${p.call}</span>
                        </div>
                    `).join('');
        }

        function renderWB() {
            const root = document.getElementById('root');

            const getPersonnelOptions = (selectedIdx) => {
                let options = `<option value="" ${selectedIdx === "" ? 'selected' : ''}>Empty</option>`;

                // Find manual entry item for the top
                const manualIdx = aircraftDatabase.personnel.findIndex(p => p.isManual);
                if (manualIdx !== -1) {
                    const p = aircraftDatabase.personnel[manualIdx];
                    const isSelected = selectedIdx !== "" && parseInt(selectedIdx) === manualIdx;
                    options += `<option value="${manualIdx}" ${isSelected ? 'selected' : ''}>‚úçÔ∏è ${p.name}</option>`;
                }

                const sortedPersonnel = aircraftDatabase.personnel
                    .map((p, idx) => ({ ...p, originalIdx: idx }))
                    .filter(p => !p.isManual) // Exclude manual from sorted list
                    .sort((a, b) => a.name.localeCompare(b.name));

                options += sortedPersonnel.map(p => {
                    const isSelected = selectedIdx !== "" && parseInt(selectedIdx) === p.originalIdx;
                    const weightStr = p.weight !== null ? ` (${p.weight} lb)` : ' [N/A]';
                    return `<option value="${p.originalIdx}" ${isSelected ? 'selected' : ''}>${p.name} (${p.call})${weightStr}</option>`;
                }).join('');
                return options;
            };

            const getWeightPrompt = (field, id) => {
                if (id === "" || id === null) return '';
                const person = aircraftDatabase.personnel[id];
                if (person && (person.weight === null || person.isManual)) {
                    const label = person.isManual ? "No name entry. Enter weight (lb):" : `Weight unknown for ${person.name}. Enter weight (lb):`;
                    const uniqueKey = `${field}-${id}`;
                    return `
                        <div class="manual-weight-prompt">
                            <label style="color: #6d28d9; font-weight: 800;">${label}</label>
                            <input type="number" value="${state.wb.manualWeights[uniqueKey] || ''}" onchange="updateManualWeight('${uniqueKey}', this.value)" placeholder="Enter weight" style="border: 1px solid #c084fc; background: #faf5ff;">
                        </div>
                    `;
                }
                return '';
            };

            const sidebarHtml = `
                <div class="sidebar">
                    <div class="sidebar-title">üë• Personnel Directory</div>
                    <div style="margin-bottom: 1rem;">
                        <input type="text" placeholder="Search personnel..." value="${state.personnelSearch}" oninput="updatePersonnelSearch(this.value)" 
                               style="width: 100%; padding: 0.6rem; border-radius: 0.5rem; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: white; font-size: 0.85rem;">
                    </div>
                    <div id="personnel-list">
                        ${getPersonnelListHtml()}
                    </div>
                </div>
            `;

            root.innerHTML = `
                <div class="flex-center" style="background: none; min-height: unset; padding-top: 2rem;">
                    <div class="app-layout">
                        ${sidebarHtml}
                        <div class="wb-content">
                            <button class="btn-back" onclick="goBackHome()">‚Üê Back Home</button>
                            <div class="card">
                                <h2>üë®‚Äç‚úàÔ∏è Student Instructor W&B</h2>
                                <p class="humorous-note">"Please don't gain weight... üçúüçîüçï if you do, let me know so we can update it! :D"</p>
                                <div class="grid">
                                    <div class="input-group">
                                        <label>Front Seat - Left (Pilot)</label>
                                        <select onchange="updateWBField('frontLeft', this.value)">
                                            ${getPersonnelOptions(state.wb.frontLeft)}
                                        </select>
                                        ${getWeightPrompt('frontLeft', state.wb.frontLeft)}
                                    </div>
                                    <div class="input-group">
                                        <label>Front Seat - Right</label>
                                        <select onchange="updateWBField('frontRight', this.value)">
                                            ${getPersonnelOptions(state.wb.frontRight)}
                                        </select>
                                        ${getWeightPrompt('frontRight', state.wb.frontRight)}
                                    </div>
                                    <div class="input-group">
                                        <label>Centre Seat - Left</label>
                                        <select onchange="updateWBField('centreLeft', this.value)">
                                            ${getPersonnelOptions(state.wb.centreLeft)}
                                        </select>
                                        ${getWeightPrompt('centreLeft', state.wb.centreLeft)}
                                    </div>
                                    <div class="input-group">
                                        <label>Centre Seat - Right</label>
                                        <select onchange="updateWBField('centreRight', this.value)">
                                            ${getPersonnelOptions(state.wb.centreRight)}
                                        </select>
                                        ${getWeightPrompt('centreRight', state.wb.centreRight)}
                                    </div>
                                    <div class="input-group">
                                        <label>Rear Seat</label>
                                        <select onchange="updateWBField('rear', this.value)">
                                            ${getPersonnelOptions(state.wb.rear)}
                                        </select>
                                        ${getWeightPrompt('rear', state.wb.rear)}
                                    </div>
                                </div>
                                <button class="btn-primary" onclick="calculateWB()">Calculate Weights</button>
                                <div id="wb-results"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function proceedToCalculator() {
            state.screen = 'calculator';
            render();
            saveState();
        }

        function calculateWB() {
            let totalWeight = 0;
            let breakdown = [];
            let missingWeight = false;

            // Handle Front Seats (Grouped)
            const flIdx = state.wb.frontLeft;
            const frIdx = state.wb.frontRight;
            let frontSeatsWeight = 0;
            let frontSeatsNames = [];

            [{ idx: flIdx, field: 'frontLeft', pos: 'L' }, { idx: frIdx, field: 'frontRight', pos: 'R' }].forEach(item => {
                if (item.idx !== "" && item.idx !== null) {
                    const person = aircraftDatabase.personnel[item.idx];
                    let weight = person.weight !== null ? person.weight : parseFloat(state.wb.manualWeights[item.field + '-' + item.idx]);
                    if (isNaN(weight)) {
                        missingWeight = true;
                    } else {
                        frontSeatsWeight += weight;
                        const weightLabel = person.weight !== null ? `${person.weight} lb` : `${weight} lb`;
                        frontSeatsNames.push(`${person.name} (${weightLabel}) FS-${item.pos}`);
                    }
                }
            });

            if (frontSeatsNames.length > 0) {
                totalWeight += frontSeatsWeight;
                const totalLabel = frontSeatsNames.length > 1 ? ` (= ${frontSeatsWeight} lb)` : '';
                breakdown.push(`<span>Front Seats:</span> <b>${frontSeatsNames.join(' + ')}${totalLabel}</b>`);
            }

            // Handle Centre Seats (Grouped)
            const clIdx = state.wb.centreLeft;
            const crIdx = state.wb.centreRight;
            let centreSeatsWeight = 0;
            let centreSeatsNames = [];

            [{ idx: clIdx, field: 'centreLeft', pos: 'L' }, { idx: crIdx, field: 'centreRight', pos: 'R' }].forEach(item => {
                if (item.idx !== "" && item.idx !== null) {
                    const person = aircraftDatabase.personnel[item.idx];
                    let weight = person.weight !== null ? person.weight : parseFloat(state.wb.manualWeights[item.field + '-' + item.idx]);
                    if (isNaN(weight)) {
                        missingWeight = true;
                    } else {
                        centreSeatsWeight += weight;
                        const weightLabel = person.weight !== null ? `${person.weight} lb` : `${weight} lb`;
                        centreSeatsNames.push(`${person.name} (${weightLabel}) CS-${item.pos}`);
                    }
                }
            });

            if (centreSeatsNames.length > 0) {
                totalWeight += centreSeatsWeight;
                const totalLabel = centreSeatsNames.length > 1 ? ` (= ${centreSeatsWeight} lb)` : '';
                breakdown.push(`<span>Centre Seats:</span> <b>${centreSeatsNames.join(' + ')}${totalLabel}</b>`);
            }

            // Handle Rear
            const rIdx = state.wb.rear;
            if (rIdx !== "" && rIdx !== null) {
                const person = aircraftDatabase.personnel[rIdx];
                let weight = person.weight !== null ? person.weight : parseFloat(state.wb.manualWeights['rear-' + rIdx]);
                if (isNaN(weight)) {
                    missingWeight = true;
                } else {
                    totalWeight += weight;
                    const weightLabel = person.weight !== null ? `${person.weight} lb` : `${weight} lb`;
                    breakdown.push(`<span>Rear Seat:</span> <b>${person.name} (${weightLabel})</b>`);
                }
            }

            const resultsDiv = document.getElementById('wb-results');
            if (missingWeight) {
                resultsDiv.innerHTML = `<div class="results" style="background: #fef2f2; border-color: #ef4444; color: #991b1b;">‚ö†Ô∏è Please enter all manual weights!</div>`;
            } else {
                resultsDiv.innerHTML = `
                    <div class="results">
                        <h3 style="color: #065f46;">‚úÖ W&B Personnel Summary</h3>
                        <div class="result-item"><span class="result-label">Total Personnel Weight:</span><span class="result-value">${totalWeight} lb</span></div>
                        <div style="margin-top: 1rem; display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.8rem; color: #334155;">
                            ${breakdown.map(b => `<div style="display: flex; justify-content: space-between; background: rgba(255,255,255,0.5); padding: 0.5rem 1rem; border-radius: 0.5rem;">${b}</div>`).join('')}
                        </div>
                    </div>
                `;
            }
        }

        function renderRunway() {
            const root = document.getElementById('root');

            // Re-use the dark theme for the runway selection screen
            const darkStyles = `
                <style>
                    .dark-calc-container {
                        --bg: #1a1d26; --panel: rgba(30, 41, 59, 0.7); --border: rgba(255,255,255,0.1);
                        --accent: #38bdf8; --accent2: #fbbf24;
                        --gold: #fbbf24; --text: #c8d0e0; --white: #f8fafc;
                        font-family: 'Barlow Condensed', sans-serif;
                        background: var(--bg); color: var(--text);
                        min-height: 100vh; padding: 20px 10px;
                        position: absolute; top: 0; left: 0; width: 100%; z-index: 2000;
                    }
                    .dark-calc-header {
                        display: flex; align-items: center; justify-content: center;
                        position: relative; margin-bottom: 30px; min-height: 40px;
                    }
                    .dark-calc-back {
                        position: absolute; left: 10px; color: var(--accent);
                        background: transparent; border: none; font-size: 1.1rem; cursor: pointer;
                        font-weight: 600; text-transform: uppercase; letter-spacing: 1px;
                        z-index: 2001;
                    }
                    .dark-calc-container h2 {
                        text-align: center; font-size: 18px; font-weight: 900;
                        letter-spacing: 3px; text-transform: uppercase;
                        color: var(--white); margin: 0; padding: 0 50px;
                        text-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    }
                    .flight-card-content {
                        max-width: 600px; margin: 0 auto;
                        display: flex; flex-direction: column; gap: 20px;
                    }
                    .flight-card-grid {
                        display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;
                    }
                    .runway-tile {
                        background: var(--panel); border: 2px solid var(--border);
                        border-radius: 16px; padding: 20px;
                        display: flex; flex-direction: column; align-items: center; gap: 12px;
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        cursor: pointer; position: relative; overflow: hidden;
                    }
                    .runway-tile.selected {
                        border-color: var(--accent);
                        background: rgba(56, 189, 248, 0.15);
                        box-shadow: 0 8px 32px rgba(56, 189, 248, 0.2);
                        transform: translateY(-4px);
                    }
                    .runway-tile:not(.selected):hover {
                        border-color: rgba(255,255,255,0.3);
                        transform: translateY(-2px);
                    }
                    .runway-icon { font-size: 40px; margin-bottom: 5px; }
                    .runway-title {
                        font-size: 18px; font-weight: 800; color: var(--white);
                        text-transform: uppercase; letter-spacing: 1px;
                    }
                    .runway-desc {
                        font-size: 12px; color: var(--text); opacity: 0.8; text-align: center;
                        font-family: 'SF Pro Display', sans-serif;
                    }
                    .dark-calc-btn {
                        background: var(--accent); color: #0f172a;
                        border: none; font-family: 'Barlow Condensed', sans-serif;
                        font-size: 20px; font-weight: 800; letter-spacing: 4px;
                        text-transform: uppercase; cursor: pointer; border-radius: 12px;
                        padding: 16px; width: 100%; transition: all 0.3s;
                        box-shadow: 0 4px 15px rgba(56, 189, 248, 0.4);
                    }
                    .dark-calc-btn:disabled {
                        background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.3);
                        cursor: not-allowed; box-shadow: none;
                    }
                </style>
            `;

            root.innerHTML = `
                ${darkStyles}
                <div class="dark-calc-container">
                    <div class="dark-calc-header">
                        <button class="dark-calc-back" onclick="goBackHome()">‚Üê Back</button>
                        <h2>‚úàÔ∏è ${state.selectedAircraft}</h2>
                    </div>
                    
                    <div class="flight-card-content">
                        <div style="text-align: center; margin-bottom: 10px;">
                            <span style="color: var(--accent); font-weight: 700; letter-spacing: 2px; text-transform: uppercase; font-size: 13px;">Select Departure Runway</span>
                        </div>
                        
                        <div class="flight-card-grid">
                            <div class="runway-tile ${state.runwayMode === 'cyxu' ? 'selected' : ''}" onclick="selectRunway('cyxu')">
                                <span class="runway-icon">üõ´</span>
                                <span class="runway-title">CYXU Runway</span>
                                <span class="runway-desc">Automatic Elevation: 912 ft</span>
                            </div>
                            <div class="runway-tile ${state.runwayMode === 'custom' ? 'selected' : ''}" onclick="selectRunway('custom')">
                                <span class="runway-icon">üéØ</span>
                                <span class="runway-title">Custom Elev</span>
                                <span class="runway-desc">Enter manual field elevation</span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <button class="dark-calc-btn" ${!state.runwayMode ? 'disabled' : ''} onclick="proceedToCalculator()">Continue to Performance</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function selectRunway(mode) {
            state.runwayMode = mode;
            state.altitude = mode === 'cyxu' ? '912' : '';
            render();
            saveState();
        }

        function renderFleet() {
            const root = document.getElementById('root');
            // Check if we are already on the fleet screen to avoid re-rendering the container
            const existingSearch = document.getElementById('fleet-search-input');

            if (!existingSearch) {
                root.innerHTML = `
                    <div class="container" style="padding-top: 1.5rem; max-width: 900px;">
                        <button class="btn-back" onclick="goBackHome()">‚Üê Back Home</button>
                        <div style="text-align: center; margin-bottom: 1.5rem;">
                            <h1 style="font-size: 2.2rem; margin-bottom: 1rem;">‚úàÔ∏èüöÅ Call Signs</h1>
                            <div style="max-width: 500px; margin: 0 auto; position: relative;">
                                <input type="text" 
                                       id="fleet-search-input"
                                       placeholder="Search Registration, Type or Call Sign..." 
                                       value="${state.fleetSearch || ''}"
                                       oninput="state.fleetSearch = this.value; updateFleetResults()"
                                       style="width: 100%; padding: 0.8rem 1.25rem; border-radius: 0.75rem; border: 2px solid #3b82f6; font-size: 1rem; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.1); outline: none;">
                                <span style="position: absolute; right: 1.1rem; top: 0.9rem; font-size: 1.1rem;">üîç</span>
                            </div>
                        </div>
                        <div id="fleet-results-container"></div>
                    </div>
                `;
            }
            updateFleetResults();
        }

        function updateFleetResults() {
            const container = document.getElementById('fleet-results-container');
            if (!container) return;

            const search = (state.fleetSearch || '').toLowerCase();
            const filteredFleet = aircraftDatabase.fleet.filter(f =>
                f.call.toLowerCase().includes(search) ||
                f.type.toLowerCase().includes(search) ||
                f.reg.toLowerCase().includes(search)
            );

            const rotary = filteredFleet.filter(f => f.category === 'Rotary Wing');
            const fixed = filteredFleet.filter(f => f.category === 'Fixed Wing');

            const renderTable = (list, title) => {
                if (list.length === 0) return '';
                return `
                    <div style="margin-bottom: 1.25rem;">
                        <h3 style="color: white; margin-bottom: 0.6rem; font-weight: 900; font-size: 1.1rem;">${title}</h3>
                        <table class="fleet-table" style="margin-top: 0;">
                            <thead>
                                <tr>
                                    <th style="padding: 0.6rem;">Call</th>
                                    <th style="padding: 0.6rem;">Type</th>
                                    <th style="padding: 0.6rem;">Reg</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${list.map(f => `
                                    <tr>
                                        <td style="font-weight: 950; color: #1e293b; background: #f1f5f9; padding: 0.5rem 0.6rem;">${f.call}</td>
                                        <td style="padding: 0.5rem 0.6rem;">${f.type}</td>
                                        <td style="font-family: monospace; font-weight: 700; color: #2563eb; padding: 0.5rem 0.6rem;">${f.reg}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            };

            if (rotary.length === 0 && fixed.length === 0) {
                container.innerHTML = `<div style="text-align: center; color: white; padding: 2rem; background: rgba(255,255,255,0.05); border-radius: 1rem;">No results found for "${state.fleetSearch}"</div>`;
            } else {
                container.innerHTML = renderTable(fixed, '‚úàÔ∏è Fixed Wing') + renderTable(rotary, 'üöÅ Rotary Wing');
            }
        }

        function calculateAll() {
            const altitude = parseFloat(state.altitude);
            const tempCelsius = parseFloat(state.temperature);
            if (isNaN(altitude) || isNaN(tempCelsius)) { alert("Please enter values!"); return; }

            const data = aircraftDatabase[state.selectedAircraft];
            let allResults = {};
            const isSR22 = state.selectedAircraft.startsWith('CF');

            if (isSR22) {
                // SR22 Logic (Celsius directly)
                if (state.weights.takeoff) allResults.takeoff = { ...calculateSR22Takeoff(data, altitude, tempCelsius, state.weights.takeoff), weight: state.weights.takeoff };
                allResults.landing = calculateSR22Landing(data, altitude, tempCelsius);
                if (state.weights.takeoffclimb) allResults.takeoffclimb = { ...calculateSR22TakeoffClimb(data, altitude, tempCelsius, state.weights.takeoffclimb), weight: state.weights.takeoffclimb };
                if (state.weights.balked) allResults.balked = { ...calculateSR22Balked(data, altitude, tempCelsius, state.weights.balked), weight: state.weights.balked };
            } else {
                // C340 Logic
                const tempF = (tempCelsius * 9 / 5) + 32; // CONVERSION FOR BALKED/OEI
                allResults.takeoff = { takeoffRoll: Math.round(bilinearInterpolate(altitude, tempCelsius, data.takeoff.altitudes, data.takeoff.temps, data.takeoff.groundRoll)), takeoffDistance: Math.round(bilinearInterpolate(altitude, tempCelsius, data.takeoff.altitudes, data.takeoff.temps, data.takeoff.totalDist)) };
                if (state.weights.accelstop) allResults.accelstop = { accelerateStopDistance: Math.round(bilinearInterpolate(altitude, tempCelsius, data.accelstop.altitudes, data.accelstop.temps, data.accelstop.data[state.weights.accelstop])), weight: state.weights.accelstop };
                allResults.landing = { landingRoll: Math.round(bilinearInterpolate(altitude, tempCelsius, data.landing.altitudes, data.landing.temps, data.landing.groundRoll)), landingDistance: Math.round(bilinearInterpolate(altitude, tempCelsius, data.landing.altitudes, data.landing.temps, data.landing.totalDist)) };
                allResults.balked = { balkedClimbRate: Math.round(bilinearInterpolate(altitude, tempF, data.balked.altitudes, data.balked.temps, data.balked.data)) };
                if (data.oei && state.weights.oei) allResults.oei = { oeiClimbRate: Math.round(bilinearInterpolate(altitude, tempF, data.oei.altitudes, data.oei.temps, data.oei.data[state.weights.oei])), weight: state.weights.oei };
            }
            state.allResults = allResults;
            render();
            saveState();
        }

        // Placeholder for SR22 calcs - can be filled if needed
        function calculateSR22Takeoff(d, a, t, w) {
            return {
                takeoffRoll: Math.round(bilinearInterpolate(a, t, d.takeoff.altitudes, d.takeoff.temps, d.takeoff.groundRoll[w])),
                takeoffDistance: Math.round(bilinearInterpolate(a, t, d.takeoff.altitudes, d.takeoff.temps, d.takeoff.totalDist[w]))
            };
        }
        function calculateSR22Landing(d, a, t) {
            return {
                landingRoll: Math.round(bilinearInterpolate(a, t, d.landing.altitudes, d.landing.temps, d.landing.groundRoll)),
                landingDistance: Math.round(bilinearInterpolate(a, t, d.landing.altitudes, d.landing.temps, d.landing.totalDist))
            };
        }
        function calculateSR22TakeoffClimb(d, a, t, w) {
            return {
                takeoffClimbRate: Math.round(bilinearInterpolate(a, t, d.takeoffclimb.altitudes, d.takeoffclimb.temps, d.takeoffclimb.data[w]))
            };
        }
        function calculateSR22Balked(d, a, t, w) {
            return {
                balkedClimbRate: Math.round(bilinearInterpolate(a, t, d.balked.altitudes, d.balked.temps, d.balked.data[w])),
                bestRateClimb: 77
            };
        }

        function renderCalculator() {
            const data = aircraftDatabase[state.selectedAircraft];

            // Re-using IAR823 dark theme variables and styles + specific overrides for C340/SR22
            const darkStyles = `
                <style>
                    .dark-calc-container {
                        /* Softer Dark Mode */
                        --bg: #1a1d26; --panel: rgba(30, 41, 59, 0.7); --border: rgba(255,255,255,0.1);
                        --accent: #38bdf8; --accent2: #fbbf24;
                        --gold: #fbbf24; --text: #c8d0e0; --white: #f8fafc;
                        font-family: 'Barlow Condensed', sans-serif;
                        background: var(--bg); color: var(--text);
                        min-height: 100vh; padding: 20px 10px;
                        position: absolute; top: 0; left: 0; width: 100%; z-index: 2000;
                    }
                    .dark-calc-header {
                        display: flex; align-items: center; justify-content: center;
                        position: relative; margin-bottom: 25px; min-height: 40px;
                    }
                    .dark-calc-back {
                        position: absolute; left: 10px; color: var(--accent);
                        background: transparent; border: none; font-size: 1.1rem; cursor: pointer;
                        font-weight: 600; text-transform: uppercase; letter-spacing: 1px;
                        z-index: 2001;
                    }
                    .dark-calc-container h2 {
                        text-align: center; font-size: 18px; font-weight: 900;
                        letter-spacing: 3px; text-transform: uppercase;
                        color: var(--white); margin: 0; padding: 0 50px;
                        text-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    }
                    .dark-calc-content {
                        max-width: 600px; margin: 0 auto;
                        display: flex; flex-direction: column; gap: 20px;
                    }
                    
                    /* Flight Card Grid Layout */
                    .flight-card-section {
                        display: flex; flex-direction: column; gap: 10px;
                    }
                    .flight-card-header {
                        display: flex; align-items: center; gap: 8px;
                        color: var(--accent); font-size: 14px; font-weight: 700; letter-spacing: 1.5px;
                        text-transform: uppercase; padding-bottom: 5px; border-bottom: 1px solid var(--border);
                    }
                    .flight-card-grid {
                        display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px;
                    }
                    
                    /* Input Tiles */
                    .input-tile {
                        background: var(--panel); border: 1px solid var(--border);
                        border-radius: 12px; padding: 12px;
                        display: flex; flex-direction: column; align-items: center; gap: 8px;
                        transition: all 0.2s ease; position: relative; overflow: hidden;
                    }
                    .input-tile:hover {
                        border-color: var(--accent); box-shadow: 0 4px 20px rgba(56, 189, 248, 0.15);
                        transform: translateY(-2px);
                    }
                    .input-tile-icon {
                        font-size: 24px; opacity: 0.8;
                    }
                    .input-tile label {
                        font-size: 11px; color: var(--text); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;
                        text-align: center; opacity: 0.7;
                    }
                    .input-tile input, .input-tile select {
                        background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(255,255,255,0.05); border-radius: 8px;
                        color: var(--white); font-family: 'Share Tech Mono', monospace; font-weight: 700;
                        font-size: 16px; width: 100%; text-align: center; padding: 8px;
                        outline: none; transition: border 0.3s;
                    }
                    .input-tile input:focus, .input-tile select:focus {
                        border-color: var(--accent); background: rgba(0,0,0,0.6);
                    }
                    .input-tile-unit {
                        position: absolute; right: 12px; bottom: 18px;
                        font-size: 10px; color: #64748b; font-weight: 700; pointer-events: none;
                    }

                    .dark-calc-btn {
                        background: linear-gradient(135deg, rgba(56, 189, 248, 0.1), rgba(56, 189, 248, 0.05)); 
                        border: 1px solid var(--accent);
                        color: var(--accent); font-family: 'Barlow Condensed', sans-serif;
                        font-size: 20px; font-weight: 800; letter-spacing: 4px;
                        text-transform: uppercase; cursor: pointer; border-radius: 12px;
                        padding: 16px; width: 100%; margin-top: 10px; transition: all 0.3s;
                        text-shadow: 0 2px 10px rgba(56, 189, 248, 0.3);
                        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    }
                    .dark-calc-btn:hover { 
                        background: var(--accent); color: #0f172a; 
                        box-shadow: 0 0 25px rgba(56, 189, 248, 0.5); 
                        transform: scale(1.02);
                    }
                    
                    .dark-results { margin-top: 25px; display: grid; gap: 12px; }
                    .dark-res-module {
                        background: rgba(255,255,255,0.03); border: 1px solid var(--border);
                        border-radius: 8px; padding: 12px;
                    }
                    .dark-mod-title {
                        font-family: 'Share Tech Mono', monospace; color: var(--gold);
                        font-size: 14px; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);
                        padding-bottom: 4px; text-align: center;
                    }
                    .dark-res-row {
                        display: flex; justify-content: space-between; align-items: center;
                        font-size: 14px; margin-bottom: 4px;
                    }
                    .dark-res-label { color: #7a85a0; }
                    .dark-res-val { color: var(--white); font-weight: bold; font-family: 'Share Tech Mono', monospace; }
                </style>
            `;

            let conditionsHtml = `
                <div class="flight-card-section">
                    <div class="flight-card-header">
                        <span>üå¶Ô∏è Conditions</span>
                    </div>
                    <div class="flight-card-grid">
                        <div class="input-tile">
                            <span class="input-tile-icon">üèîÔ∏è</span>
                            <label>Runway Elev</label>
                            <input type="number" value="${state.altitude}" ${state.runwayMode === 'cyxu' ? 'disabled' : ''} onchange="state.altitude=this.value;render();saveState()">
                            ${state.runwayMode === 'cyxu' ? '<span class="input-tile-unit" style="bottom: 40px; right: auto; font-size: 9px; color: var(--accent);">CYXU</span>' : ''}
                        </div>
                        <div class="input-tile">
                            <span class="input-tile-icon">üå°Ô∏è</span>
                            <label>Temperature</label>
                            <input type="number" value="${state.temperature}" onchange="state.temperature=this.value;render();saveState()" placeholder="15">
                        </div>
                    </div>
                </div>
            `;

            let weightInputsHtml = '';
            const isSR22 = state.selectedAircraft.startsWith('CF');

            if (isSR22) {
                const modules = [
                    { id: 'takeoff', name: 'Take-Off', icon: 'üõ´', weights: data.takeoff?.weights || [3400, 2900] },
                    { id: 'takeoffclimb', name: 'Take-Off Climb', icon: 'üìà', weights: data.takeoffclimb?.weights || [3400, 2900] },
                    { id: 'balked', name: 'Balked Climb', icon: '‚ö†Ô∏è', weights: data.balked?.weights || [3400, 2900] }
                ];
                weightInputsHtml = `
                    <div class="flight-card-section">
                        <div class="flight-card-header">
                            <span>‚öñÔ∏è Performance Config</span>
                        </div>
                        <div class="flight-card-grid">
                            ${modules.map(m => `
                                <div class="input-tile">
                                    <span class="input-tile-icon">${m.icon}</span>
                                    <label>${m.name}</label>
                                    <select onchange="state.weights['${m.id}']=this.value;render();saveState()">
                                        <option value="">Select</option>
                                        ${m.weights.map(w => `<option value="${w}" ${state.weights[m.id] == w ? 'selected' : ''}>${w} lb</option>`).join('')}
                                    </select>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else if (data.accelstop) {
                weightInputsHtml = `
                    <div class="flight-card-section">
                        <div class="flight-card-header">
                            <span>‚öñÔ∏è Performance Config</span>
                        </div>
                        <div class="flight-card-grid">
                            <div class="input-tile">
                                <span class="input-tile-icon">üõë</span>
                                <label>Accel-Stop</label>
                                <select onchange="state.weights['accelstop']=this.value;render();saveState()">
                                    <option value="">Select</option>
                                    ${data.accelstop.weights.map(w => `<option value="${w}" ${state.weights.accelstop == w ? 'selected' : ''}>${w} lb</option>`).join('')}
                                </select>
                            </div>
                            ${data.oei ? `
                            <div class="input-tile">
                                <span class="input-tile-icon">üêå</span>
                                <label>OEI Climb</label>
                                <select onchange="state.weights['oei']=this.value;render();saveState()">
                                    <option value="">Select</option>
                                    ${data.oei.weights.map(w => `<option value="${w}" ${state.weights.oei == w ? 'selected' : ''}>${w} lb</option>`).join('')}
                                </select>
                            </div>` : ''}
                        </div>
                    </div>
                `;
            }

            let resultsHtml = '';
            if (state.allResults) {
                resultsHtml = '<div class="dark-results">';
                Object.entries(state.allResults).forEach(([key, res]) => {
                    resultsHtml += `
                        <div class="dark-res-module">
                            <div class="dark-mod-title">${key.toUpperCase()} ${res.weight ? `(${res.weight} lb)` : ''}</div>
                            ${res.takeoffRoll ? `<div class="dark-res-row"><span class="dark-res-label">Roll</span><span class="dark-res-val">${res.takeoffRoll} ft</span></div>` : ''}
                            ${res.takeoffDistance ? `<div class="dark-res-row"><span class="dark-res-label">Total</span><span class="dark-res-val">${res.takeoffDistance} ft</span></div>` : ''}
                            ${res.landingRoll ? `<div class="dark-res-row"><span class="dark-res-label">Roll</span><span class="dark-res-val">${res.landingRoll} ft</span></div>` : ''}
                            ${res.landingDistance ? `<div class="dark-res-row"><span class="dark-res-label">Total</span><span class="dark-res-val">${res.landingDistance} ft</span></div>` : ''}
                            ${res.accelerateStopDistance ? `<div class="dark-res-row"><span class="dark-res-label">Dist</span><span class="dark-res-val">${res.accelerateStopDistance} ft</span></div>` : ''}
                            ${res.balkedClimbRate ? `<div class="dark-res-row"><span class="dark-res-label">Rate</span><span class="dark-res-val">${res.balkedClimbRate} fpm</span></div>` : ''}
                            ${res.oeiClimbRate ? `<div class="dark-res-row"><span class="dark-res-label">OEI Rate</span><span class="dark-res-val">${res.oeiClimbRate} fpm</span></div>` : ''}
                            ${res.takeoffClimbRate ? `<div class="dark-res-row"><span class="dark-res-label">Rate</span><span class="dark-res-val">${res.takeoffClimbRate} fpm</span></div>` : ''}
                        </div>
                    `;
                });
                resultsHtml += '</div>';
            }

            const root = document.getElementById('root');
            root.innerHTML = `
                ${darkStyles}
                <div class="dark-calc-container">
                    <div class="dark-calc-header">
                        <button class="dark-calc-back" onclick="state.screen='runway';render();">‚Üê Back</button>
                        <h2>üöÄ ${state.selectedAircraft}</h2>
                    </div>
                    
                    <div class="dark-calc-content">
                        ${conditionsHtml}
                        ${weightInputsHtml}
                        <button class="dark-calc-btn" onclick="calculateAll()">Calculate</button>
                        ${resultsHtml}
                    </div>
                </div>
            `;
        }


        // IAR823 Calculator Logic
        function renderIAR823() {
            state.screen = 'iar823';
            saveState();
            const root = document.getElementById('root');
            root.innerHTML = `
                <style>
                    .iar823-container {
                        --bg: #0d0f14; --panel: #13161e; --border: #1e2535;
                        --accent: #00e5ff; --accent2: #ff4757;
                        --gold: #ffd32a; --text: #c8d0e0; --white: #eef2ff;
                        font-family: 'Barlow Condensed', sans-serif;
                        background: var(--bg); color: var(--text);
                        min-height: 100vh; padding: 20px 10px;
                        position: absolute; top: 0; left: 0; width: 100%; z-index: 2000;
                    }
                    .iar823-container h1 {
                        text-align: center; font-size: 24px; font-weight: 900;
                        letter-spacing: 6px; text-transform: uppercase;
                        color: var(--white); margin-bottom: 6px;
                    }
                    .iar823-container .subtitle {
                        text-align: center; font-family: 'Share Tech Mono', monospace;
                        font-size: 11px; color: var(--accent); letter-spacing: 4px; margin-bottom: 28px;
                    }
                    .iar823-container .inputs {
                        display: flex; justify-content: center;
                        gap: 15px; flex-wrap: wrap; margin-bottom: 20px;
                    }
                    .iar823-container .input-group {
                        background: #0f111a; border: 1px solid var(--border);
                        border-radius: 8px; padding: 10px 15px;
                        display: flex; flex-direction: column; align-items: center; gap: 6px; min-width: 120px;
                    }
                    .iar823-container .input-group label { font-size: 11px; letter-spacing: 3px; color: var(--accent); text-transform: uppercase; }
                    .iar823-container .input-group input {
                        background: #070810; border: 1px solid #2a3248; border-radius: 4px;
                        color: var(--gold); font-family: 'Share Tech Mono', monospace;
                        font-size: 18px; width: 100px; text-align: center; padding: 4px 8px;
                        outline: none; transition: border-color 0.2s;
                    }
                    .iar823-container .input-group input:focus { border-color: var(--accent); }
                    .iar823-container .input-group .unit { font-size: 11px; color: #5a6380; letter-spacing: 2px; }
                    .iar823-container .calc-btn {
                        display: block; margin: 0 auto 28px; padding: 12px 48px;
                        background: transparent; border: 2px solid var(--accent);
                        color: var(--accent); font-family: 'Barlow Condensed', sans-serif;
                        font-size: 16px; font-weight: 700; letter-spacing: 4px;
                        text-transform: uppercase; cursor: pointer; border-radius: 4px; transition: all 0.2s;
                    }
                    .iar823-container .calc-btn:hover { background: var(--accent); color: var(--bg); }
                    .iar823-container .chart-wrapper {
                        background: #13161e; border-radius: 10px;
                        border: 1px solid var(--border);
                        padding: 20px 10px; overflow-x: auto;
                        max-width: 1000px; margin: 0 auto;
                    }
                    .iar823-container .result-box {
                        background: #0f111a; border: 1px solid var(--border);
                        border-radius: 10px; margin-top: 28px; padding: 28px; text-align: center;
                    }
                    .iar823-container .result-box h2 {
                        font-size: 13px; letter-spacing: 5px; color: var(--accent);
                        text-transform: uppercase; margin-bottom: 16px;
                    }
                    .iar823-container .result-distance {
                        font-family: 'Share Tech Mono', monospace; font-size: 54px;
                        font-weight: bold; color: var(--gold); line-height: 1;
                    }
                    .iar823-container .result-unit { font-size: 18px; color: var(--gold); opacity: 0.7; margin-bottom: 12px; }
                    .iar823-container .result-safety { font-size: 14px; color: #7a85a0; letter-spacing: 2px; }
                    .iar823-container .result-safety span { color: var(--accent2); font-weight: bold; }
                    .iar823-container #noResult { font-family: 'Share Tech Mono', monospace; color: #5a6380; font-size: 20px; }
                    
                    /* Climb Section */
                    .climb-section { margin-top: 20px; border-top: 1px solid var(--border); padding-top: 20px; }
                    .climb-options { display: flex; justify-content: center; gap: 20px; margin-bottom: 15px; }
                    .climb-opt { cursor: pointer; display: flex; align-items: center; gap: 8px; color: #7a85a0; font-size: 14px; }
                    .climb-opt input { accent-color: var(--accent); }
                    .climb-opt.selected { color: var(--white); font-weight: bold; }

                    .iar823-container .debug-box {
                        background: #0a0c14; border: 1px solid #1e2535; border-radius: 8px;
                        margin-top: 14px; padding: 12px 24px;
                        font-family: 'Share Tech Mono', monospace; font-size: 12px;
                        color: #6a8080; line-height: 2;
                    }
                    .iar823-container .debug-box span { color: #00e5ff; }
                    .iar823-back {
                        position: absolute; top: 20px; left: 20px; color: var(--accent);
                        background: transparent; border: none; font-size: 1.2rem; cursor: pointer;
                    }

                    /* Split Layout */
                    .iar823-container .top-section {
                        display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 20px;
                        align-items: center; justify-content: center;
                        max-width: 1000px; margin-left: auto; margin-right: auto;
                    }
                    .iar823-container .left-panel, .iar823-container .right-panel {
                        flex: 1; min-width: 300px; max-width: 450px;
                        display: flex; flex-direction: column;
                    }
                    .iar823-container .left-panel { justify-content: center; }
                    .iar823-container .inputs {
                        display: grid; grid-template-columns: repeat(3, 1fr);
                        gap: 10px; margin-bottom: 20px;
                    }
                    .iar823-container .inputs .input-group { min-width: 0; text-align: center; }
                    .iar823-container .inputs label { display: block; width: 100%; text-align: center; }
                    .iar823-container .inputs input { text-align: center; }
                    .iar823-container .inputs .unit { display: block; width: 100%; text-align: center; }
                    .iar823-container .calc-btn { width: 100%; margin-bottom: 0; }
                    
                    .iar823-container .results-grid {
                        display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
                        height: 100%; align-items: stretch;
                    }
                    .iar823-container .result-card {
                        background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;
                        text-align: center; border: 1px solid rgba(255,255,255,0.1);
                        display: flex; flex-direction: column; justify-content: center; align-items: center;
                    }
                    .iar823-container .result-box { margin-top: 0; height: 100%; display: flex; flex-direction: column; justify-content: center; }
                </style>
                
                <div class="iar823-container">
                    <button class="iar823-back" onclick="goBackHome()">‚Üê Back</button>
                    <div style="height: 20px;"></div>
                    <h1>Takeoff Performance</h1>
                    <div class="subtitle">IAR823-CFPIU Calculator</div>

                    <div class="top-section">
                        <div class="left-panel">
                            <div class="inputs">
                                <div class="input-group">
                                    <label>OAT</label>
                                    <input type="number" id="oat" value="${state.iar823.oat}" min="-15" max="35" onchange="state.iar823.oat=this.value;saveState()">
                                    <span class="unit">¬∞C</span>
                                </div>
                                <div class="input-group">
                                    <label>Weight</label>
                                    <input type="number" id="weight" value="${state.iar823.weight}" min="2600" max="3400" step="10" onchange="state.iar823.weight=this.value;saveState()">
                                    <span class="unit">lb</span>
                                </div>
                                <div class="input-group">
                                    <label>Wind</label>
                                    <input type="number" id="wind" value="${state.iar823.wind}" min="0" max="30" onchange="state.iar823.wind=this.value;saveState()">
                                    <span class="unit">kt headwind</span>
                                </div>
                            </div>
                            <button class="calc-btn" onclick="calculateIAR823()">‚ñ∂  Calculate</button>
                        </div>

                        <div class="right-panel">
                            <div class="results-grid">
                                <div class="result-card">
                                    <h2>Takeoff Distance</h2>
                                    <div id="noResult" style="display:none;">‚Äî</div>
                                    <div id="resultContent">
                                        <div class="result-distance" id="resultVal">‚Äî</div>
                                        <div class="result-unit">feet</div>
                                    </div>
                                </div>

                                <div class="result-card">
                                    <h2>Rate of Climb</h2>
                                    <div class="result-distance" id="climbResult">‚Äî</div>
                                    <div class="result-unit">ft/min</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="chart-wrapper">
                        <svg id="chart" is="iar-chart" width="1160" height="620" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>

                    <div class="debug-box" id="debugBox" style="display:none;">
                        <div id="debugText"></div>
                    </div>
                </div>
            `;

            // Load Google Fonts dynamically if not present
            if (!document.getElementById('iar-fonts')) {
                const link = document.createElement('link');
                link.id = 'iar-fonts';
                link.rel = 'stylesheet';
                link.href = 'https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Barlow+Condensed:wght@400;600;700;900&display=swap';
                document.head.appendChild(link);
            }

            // Auto-calculate on load
            setTimeout(calculateIAR823, 100);
        }

        function calculateIAR823() {
            const oat = parseFloat(document.getElementById('oat').value);
            const weightLb = parseFloat(document.getElementById('weight').value);
            const windKt = parseFloat(document.getElementById('wind').value);

            // Update state with Raw inputs
            state.iar823 = { ...state.iar823, oat, weight: weightLb, wind: windKt };
            saveState();

            // Unit Conversions for Chart
            const weightKg = weightLb * 0.453592;
            const windMs = windKt * 0.514444;

            // Draw Chart (using converted metric values)
            drawIARChart(oat, Math.round(weightKg), parseFloat(windMs.toFixed(1)), true);

            // Rate of Climb Logic (Linear Interpolation)
            // 2750 lb -> 1381 ft/min
            // 3300 lb -> 955 ft/min
            const w1 = 2750, r1 = 1381;
            const w2 = 3300, r2 = 955;

            let climbRate;
            if (weightLb <= w1) climbRate = r1;
            else if (weightLb >= w2) climbRate = r2;
            else {
                // Linear Interpolation: y = y1 + (x - x1) * (y2 - y1) / (x2 - x1)
                climbRate = r1 + (weightLb - w1) * (r2 - r1) / (w2 - w1);
            }

            document.getElementById('climbResult').textContent = Math.round(climbRate);
            saveState();




        }

        function drawIARChart(oat, weightKg, windMs, showPath) {
            const svg = document.getElementById('chart');
            if (!svg) return;
            svg.innerHTML = '';
            // Make responsive by setting viewBox but removing fixed width/height attributes
            svg.setAttribute('viewBox', '0 0 1200 620');
            svg.removeAttribute('width');
            svg.removeAttribute('height');
            svg.style.width = '100%';
            svg.style.height = 'auto';
            svg.style.maxWidth = '1000px'; // Limit max width for better readability on large screens
            svg.style.display = 'block';
            svg.style.margin = '0 auto';

            const ns = 'http://www.w3.org/2000/svg';

            /* Constants from user code */
            const SVG_TOP = 60, SVG_BOT = 540, CH = SVG_BOT - SVG_TOP;
            const u2s = u => SVG_BOT - (u / 100) * CH;
            // X layout - Shifted slightly left to make room for result text on right
            const AX_LEFT = 65, S1_RIGHT = 290, REF1 = 335, S2_RIGHT = 585, REF2 = 640, S3_RIGHT = 895, RES_X = 950;

            const CYXU_LINE = { oat0: -15, y0: 26, oat1: 26, y1: 42 };
            function cyxuY(oat) {
                const slope = (CYXU_LINE.y1 - CYXU_LINE.y0) / (CYXU_LINE.oat1 - CYXU_LINE.oat0);
                return CYXU_LINE.y0 + slope * (oat - CYXU_LINE.oat0);
            }
            const WT_LINES = [
                { x0: 1200, y0: 25, x1: 1500, y1: 40 }, { x0: 1200, y0: 32, x1: 1500, y1: 50 },
                { x0: 1200, y0: 36, x1: 1500, y1: 58 }, { x0: 1200, y0: 41, x1: 1500, y1: 65 }
            ];
            const WT_MIN = 1200, WT_MAX = 1500;
            function wtX(kg) { return REF1 + (kg - WT_MIN) / (WT_MAX - WT_MIN) * (S2_RIGHT - REF1); }
            function wtLineY(lineIdx, kg) {
                const L = WT_LINES[lineIdx];
                return L.y0 + (kg - L.x0) / (L.x1 - L.x0) * (L.y1 - L.y0);
            }
            function sec2Trace(entryY, weightKg) {
                const ys0 = WT_LINES.map(L => L.y0);
                const yC = Math.max(ys0[0], Math.min(ys0[ys0.length - 1], entryY));
                let lo = 0;
                for (let i = 0; i < ys0.length - 1; i++) { if (yC >= ys0[i] && yC <= ys0[i + 1]) { lo = i; break; } }
                if (yC < ys0[0]) lo = 0; if (yC > ys0[ys0.length - 1]) lo = ys0.length - 2;
                const hi = Math.min(lo + 1, ys0.length - 1);
                const span = ys0[hi] - ys0[lo];
                const t = span === 0 ? 0 : (yC - ys0[lo]) / span;
                const yLo = wtLineY(lo, weightKg), yHi = wtLineY(hi, weightKg);
                return { y: yLo + t * (yHi - yLo), x: wtX(weightKg) };
            }
            const WD_LINES = [
                { x0: 0, y0: 24, x1: 15, y1: 13 }, { x0: 0, y0: 32, x1: 15, y1: 21 }, { x0: 0, y0: 39, x1: 15, y1: 28 },
                { x0: 0, y0: 51, x1: 15, y1: 39 }, { x0: 0, y0: 58, x1: 15, y1: 46 }, { x0: 0, y0: 65, x1: 15, y1: 53 }
            ];
            const WD_MIN = 0, WD_MAX = 15;
            function wdX(v) { return REF2 + (v - WD_MIN) / (WD_MAX - WD_MIN) * (S3_RIGHT - REF2); }
            function wdLineY(lineIdx, wind) {
                const L = WD_LINES[lineIdx];
                return L.y0 + (wind - L.x0) / (L.x1 - L.x0) * (L.y1 - L.y0);
            }
            function sec3Trace(entryY, windMs) {
                const ys0 = WD_LINES.map(L => L.y0);
                const yC = Math.max(ys0[0], Math.min(ys0[ys0.length - 1], entryY));
                let lo = 0;
                for (let i = 0; i < ys0.length - 1; i++) { if (yC >= ys0[i] && yC <= ys0[i + 1]) { lo = i; break; } }
                if (yC < ys0[0]) lo = 0; if (yC > ys0[ys0.length - 1]) lo = ys0.length - 2;
                const hi = Math.min(lo + 1, ys0.length - 1);
                const span = ys0[hi] - ys0[lo];
                const t = span === 0 ? 0 : (yC - ys0[lo]) / span;
                const yLo = wdLineY(lo, windMs), yHi = wdLineY(hi, windMs);
                return { y: yLo + t * (yHi - yLo), x: wdX(windMs) };
            }
            const SCALE_PTS = [{ u: 10.5, m: 200 }, { u: 21, m: 400 }, { u: 32.5, m: 600 }, { u: 43, m: 800 }, { u: 54, m: 1000 }, { u: 65, m: 1200 }];
            function unitToM(u) {
                if (u <= SCALE_PTS[0].u) return SCALE_PTS[0].m;
                if (u >= SCALE_PTS[SCALE_PTS.length - 1].u) return SCALE_PTS[SCALE_PTS.length - 1].m;
                for (let i = 0; i < SCALE_PTS.length - 1; i++) {
                    const lo = SCALE_PTS[i], hi = SCALE_PTS[i + 1];
                    if (u >= lo.u && u <= hi.u) { return Math.round(lo.m + (u - lo.u) / (hi.u - lo.u) * (hi.m - lo.m)); }
                }
                return 0;
            }
            const OAT_MIN = -15, OAT_MAX = 35;
            function oatX(v) { return AX_LEFT + (v - OAT_MIN) / (OAT_MAX - OAT_MIN) * (S1_RIGHT - AX_LEFT); }

            function E(tag, a, t) {
                const e = document.createElementNS(ns, tag);
                for (const [k, v] of Object.entries(a)) e.setAttribute(k, v);
                if (t !== undefined) e.textContent = t;
                return e;
            }
            function L(x1, y1, x2, y2, col, w, dash) {
                const a = { x1, y1, x2, y2, stroke: col || '#e2e8f0', 'stroke-width': w || 2 };
                if (dash) a['stroke-dasharray'] = dash;
                return E('line', a);
            }
            function T(x, y, s, fs, fw, col, anch, xf) {
                const a = { x, y, 'font-size': fs || 11, 'font-weight': fw || 'normal', fill: col || '#cbd5e1', 'text-anchor': anch || 'middle', 'font-family': "'Barlow Condensed',Arial,sans-serif" };
                if (xf) a.transform = xf;
                return E('text', a, s);
            }
            function G(id) { const g = E('g', { id }); svg.appendChild(g); return g; }

            // Dark Mode Background
            svg.appendChild(E('rect', { x: 0, y: 0, width: 1160, height: 620, fill: '#13161e' }));
            svg.appendChild(T(580, 28, 'TAKE OFF DISTANCE', 16, 900, '#e2e8f0'));
            const midY = (SVG_TOP + SVG_BOT) / 2;
            const g1 = G('s1');
            g1.appendChild(L(AX_LEFT, SVG_TOP - 5, AX_LEFT, SVG_BOT, '#cbd5e1', 3));
            g1.appendChild(L(AX_LEFT, SVG_BOT, S1_RIGHT + 80, SVG_BOT, '#cbd5e1', 3));
            g1.appendChild(T(AX_LEFT - 22, midY, 'CYXU', 12, 700, '#cbd5e1', 'middle', `rotate(-90 ${AX_LEFT - 22} ${midY})`));
            [-15, -5, 5, 15, 25, 35].forEach(v => { const x = oatX(v); g1.appendChild(L(x, SVG_BOT, x, SVG_BOT + 5, '#64748b', 1.5)); g1.appendChild(T(x, SVG_BOT + 17, String(v), 11, 'normal', '#94a3b8')); });
            g1.appendChild(T((AX_LEFT + S1_RIGHT) / 2 + 20, SVG_BOT + 34, 'OAT  Celsius', 12, 700, '#e2e8f0'));
            { const x0 = AX_LEFT, y0 = u2s(cyxuY(OAT_MIN)); const x1 = oatX(OAT_MAX), y1 = u2s(cyxuY(OAT_MAX)); g1.appendChild(L(x0, y0, x1, y1, '#f87171', 2)); g1.appendChild(E('circle', { cx: x0, cy: y0, r: 5, fill: 'none', stroke: '#f87171', 'stroke-width': 2 })); g1.appendChild(T(x0 - 28, y0 + 4, 'CYXU', 11, 700, '#f87171', 'middle')); }

            let p1 = null;
            if (showPath) {
                const xOAT = oatX(oat); const yU = cyxuY(oat); const yS = u2s(yU);
                g1.appendChild(L(xOAT, SVG_BOT, xOAT, yS, '#0055ff', 2, '7,4')); g1.appendChild(E('circle', { cx: xOAT, cy: SVG_BOT, r: 4, fill: '#0055ff', stroke: 'none' }));
                g1.appendChild(E('circle', { cx: xOAT, cy: yS, r: 6, fill: '#0055ff', stroke: 'white', 'stroke-width': 2 })); g1.appendChild(T(xOAT + 10, yS - 9, '‚ë†', 13, 700, '#0055ff', 'start'));
                g1.appendChild(L(xOAT, yS, REF1, yS, '#888', 1.5, '5,3')); p1 = { svgY: yS, unitY: yU };
            }

            const gR1 = G('r1'); gR1.appendChild(L(REF1, SVG_TOP - 15, REF1, SVG_BOT, '#cbd5e1', 4)); gR1.appendChild(T(REF1 + 10, midY, 'Ref  line', 12, 700, '#cbd5e1', 'middle', `rotate(-90 ${REF1 + 10} ${midY})`));
            if (p1) gR1.appendChild(E('circle', { cx: REF1, cy: p1.svgY, r: 5, fill: 'none', stroke: '#38bdf8', 'stroke-width': 2 }));

            const g2 = G('s2'); g2.appendChild(L(REF1, SVG_BOT, S2_RIGHT + 20, SVG_BOT, '#cbd5e1', 3));
            [1200, 1300, 1400, 1500].forEach(v => { const x = wtX(v); g2.appendChild(L(x, SVG_BOT, x, SVG_BOT + 5, '#64748b', 1.5)); g2.appendChild(T(x, SVG_BOT + 17, String(v), 11, 'normal', '#94a3b8')); });
            g2.appendChild(T((REF1 + S2_RIGHT) / 2, SVG_BOT + 34, 'Weight (kg)', 12, 700, '#e2e8f0'));
            WT_LINES.forEach((ln, i) => { const x0 = REF1, y0 = u2s(ln.y0); const x1 = S2_RIGHT, y1 = u2s(wtLineY(i, WT_MAX)); g2.appendChild(L(x0, y0, x1, y1, '#fca5a5', 2)); g2.appendChild(E('circle', { cx: x0, cy: y0, r: 5, fill: 'none', stroke: '#94a3b8', 'stroke-width': 1.5 })); });

            let p2 = null;
            if (showPath && p1) {
                const r2 = sec2Trace(p1.unitY, weightKg); const r2s = u2s(r2.y);
                g2.appendChild(L(REF1, p1.svgY, r2.x, r2s, '#38bdf8', 2.5, '7,4')); g2.appendChild(E('circle', { cx: r2.x, cy: r2s, r: 6, fill: '#38bdf8', stroke: 'white', 'stroke-width': 2 }));
                g2.appendChild(T(r2.x + 10, r2s - 9, '‚ë°', 13, 700, '#38bdf8', 'start')); g2.appendChild(L(r2.x, r2s, REF2, r2s, '#64748b', 1.5, '5,3')); p2 = { svgY: r2s, unitY: r2.y };
            }

            const gR2 = G('r2'); gR2.appendChild(L(REF2, SVG_TOP - 15, REF2, SVG_BOT, '#cbd5e1', 4)); gR2.appendChild(T(REF2 + 10, midY, 'Ref  line', 12, 700, '#cbd5e1', 'middle', `rotate(-90 ${REF2 + 10} ${midY})`));
            if (p2) gR2.appendChild(E('circle', { cx: REF2, cy: p2.svgY, r: 5, fill: 'none', stroke: '#38bdf8', 'stroke-width': 2 }));

            const g3 = G('s3'); g3.appendChild(L(REF2, SVG_BOT, S3_RIGHT + 20, SVG_BOT, '#cbd5e1', 3));
            [0, 5, 10, 15].forEach(v => { const x = wdX(v); g3.appendChild(L(x, SVG_BOT, x, SVG_BOT + 5, '#64748b', 1.5)); g3.appendChild(T(x, SVG_BOT + 17, String(v), 11, 'normal', '#94a3b8')); });
            g3.appendChild(T((REF2 + S3_RIGHT) / 2, SVG_BOT + 32, 'Wind Component', 12, 700, '#e2e8f0')); g3.appendChild(T((REF2 + S3_RIGHT) / 2, SVG_BOT + 46, 'm/sec', 11, 'normal', '#94a3b8'));
            WD_LINES.forEach((ln, i) => { const x0 = REF2, y0 = u2s(ln.y0); const x1 = S3_RIGHT, y1 = u2s(wdLineY(i, WD_MAX)); g3.appendChild(L(x0, y0, x1, Math.min(y1, SVG_BOT), '#fca5a5', 2)); g3.appendChild(E('circle', { cx: x0, cy: y0, r: 5, fill: 'none', stroke: '#94a3b8', 'stroke-width': 1.5 })); });

            let p3 = null;
            if (showPath && p2) {
                const r3 = sec3Trace(p2.unitY, windMs); const r3s = u2s(r3.y);
                g3.appendChild(L(REF2, p2.svgY, r3.x, r3s, '#38bdf8', 2.5, '7,4')); g3.appendChild(E('circle', { cx: r3.x, cy: r3s, r: 6, fill: '#38bdf8', stroke: 'white', 'stroke-width': 2 }));
                g3.appendChild(T(r3.x + 10, r3s - 9, '‚ë¢', 13, 700, '#38bdf8', 'start')); g3.appendChild(L(r3.x, r3s, RES_X, r3s, '#64748b', 1.5, '5,3')); p3 = { svgY: r3s, unitY: r3.y };
            }

            const gRes = G('res'); gRes.appendChild(T(RES_X + 10, midY, 'Ref  line', 12, 700, '#38bdf8', 'middle', `rotate(-90 ${RES_X + 10} ${midY})`));
            SCALE_PTS.forEach(({ u, m }) => { const sy = u2s(u); gRes.appendChild(L(RES_X - 5, sy, RES_X + 5, sy, '#64748b', 2)); gRes.appendChild(T(RES_X + 12, sy + 4, `‚Äì${m}`, 11, 'normal', '#94a3b8', 'start')); });
            const syTop = u2s(SCALE_PTS[SCALE_PTS.length - 1].u); const syBot = u2s(SCALE_PTS[0].u); gRes.appendChild(L(RES_X, syTop, RES_X, syBot, '#38bdf8', 4));

            if (showPath && p3) {
                const metres = unitToM(p3.unitY);
                const feet = Math.round(metres * 3.28084);

                gRes.appendChild(E('circle', { cx: RES_X, cy: p3.svgY, r: 8, fill: '#fbbf24', stroke: 'white', 'stroke-width': 2.5 }));
                gRes.appendChild(T(RES_X + 14, p3.svgY - 12, '‚ë£', 13, 700, '#fbbf24', 'start'));
                gRes.appendChild(L(RES_X, p3.svgY, RES_X + 160, p3.svgY, '#fbbf24', 2.5, '8,4'));

                // Show result text on chart (in feet)
                gRes.appendChild(T(RES_X + 12, p3.svgY + 28, `${feet} ft`, 28, 900, '#fbbf24', 'start')); // Moved below line to prevent cutoff

                document.getElementById('noResult').style.display = 'none';
                document.getElementById('resultContent').style.display = 'block';
                document.getElementById('resultVal').textContent = feet;

                document.getElementById('debugBox').style.display = 'none';
            }
        }

        function renderDocuments() {
            const root = document.getElementById('root');
            root.innerHTML = `
                <div class="container" style="padding-top: 2rem;">
                    <button class="btn-back" onclick="goBackHome()">‚Üê Back Home</button>
                <div class="card" style="content-visibility: auto; contain-intrinsic-size: 1px 1000px;">
                    <h2>üìÑ Documents</h2>
                        <div class="input-group" style="margin-bottom: 1.5rem;">
                            <label>üîç Search Documents</label>
                            <input type="text" id="docSearch" placeholder="Type document name..." onkeyup="filterDocuments()" style="width: 100%; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 0.75rem; font-size: 1.1rem;">
                        </div>
                        <div id="documentsList" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1.5rem;">
                            <!-- GROUP 1: Academic & Reports -->
                            <a href="https://drive.google.com/file/d/1mpqxYIw3lcip_OWvv2obJBC7tlYQE1CL/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="In Flight Guide">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #4f46e5, #312e81);">
                                    <span class="btn-icon">‚úàÔ∏è</span>
                                    <span class="btn-text">In Flight Guide</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/1P6EUb6A4Tte5VzCcsvVrxaUZx6oNbeP2/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="Training Brief">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #4f46e5, #312e81);">
                                    <span class="btn-icon">üìã</span>
                                    <span class="btn-text">Training Brief</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/1W-aIwCTtaFuxdQM731Jr5Dme4Qeab94I/view?usp=drive_link" target="_blank" style="text-decoration: none;" class="doc-item" data-name="Training Sortie Matrix">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #4f46e5, #312e81);">
                                    <span class="btn-icon">üìã</span>
                                    <span class="btn-text">Training Sortie Matrix</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/1ham7mlkm3w2fCZwNYclGupYliQio3vdQ/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="ITPS Report Writing and Presentation Guide">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #4f46e5, #312e81);">
                                    <span class="btn-icon">üìñ</span>
                                    <span class="btn-text">Report Writing Guide</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/1jKKl0ag3dJ0dDH8OMn7enaV-itq0R03k/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="Appendix 2-1-22 Full Report Template">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #64748b, #334155);">
                                    <span class="btn-icon">üìÑ</span>
                                    <span class="btn-text">Full Report Template</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/1zDyTvx1kqgJ3ftgyQVIPYthyAtevZGtS/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="Appendix 2-1-24 Post Flight Report Template">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #64748b, #334155);">
                                    <span class="btn-icon">üìÑ</span>
                                    <span class="btn-text">Post Flight Report Template</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/1bhsOt_pPwLnOHVPv8MHoA82IM7TMD24C/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="Appendix 2-1-23 Graphical Report Template">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #64748b, #334155);">
                                    <span class="btn-icon">üìÑ</span>
                                    <span class="btn-text">Graphical Report Template</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/1PxyUSMO0ZufzoS1RvzKhDZJbkBYMjdMc/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="Appendix 2-1-16 Flight Test Plan Template">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #64748b, #334155);">
                                    <span class="btn-icon">üìÑ</span>
                                    <span class="btn-text">Test Plan Template</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/1v_XPtMTJyk-gPzAw8y3Z6-c_jE29Efnx/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="Appendix 2-1-17 Flight Test Planning Sheet Template">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #64748b, #334155);">
                                    <span class="btn-icon">üìÑ</span>
                                    <span class="btn-text">Planning Sheet Template</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/18SV97zZto0MESgk6Jlvdw_USW-eo4EW_/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="Appendix 2-1-21 Compliance Report Template">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #64748b, #334155);">
                                    <span class="btn-icon">üìÑ</span>
                                    <span class="btn-text">Compliance Report Template</span>
                                </button>
                            </a>

                            <!-- NEW Academic Materials -->
                            <a href="https://drive.google.com/file/d/1pihR2sAQoqAf_lpKXyYaHjWG8YA4EZF9/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="FW_RWPERF_ALL">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #1e293b, #0f172a);">
                                    <span class="btn-icon">üìö</span>
                                    <span class="btn-text">Performance Lectures</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/1MzarM5dl-NMhY2pVzXC4FLvlrFm0NvqV/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="All_FQ_Lectures">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #1e293b, #0f172a);">
                                    <span class="btn-icon">üìö</span>
                                    <span class="btn-text">FQ Lectures</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/1jq5uZ0z6BpCzGsHUuh-qze58AFu9p0T7/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="All_Lectures_Avionic">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #1e293b, #0f172a);">
                                    <span class="btn-icon">üìö</span>
                                    <span class="btn-text">Avionic Lectures</span>
                                </button>
                            </a>

                            <!-- Special Data Reduction Excels -->
                            <a href="https://docs.google.com/spreadsheets/d/1c5bXEuHv4igPvpJ9wuDrQU6wfn-MSeRq/edit?usp=sharing&ouid=107800747874909130471&rtpof=true&sd=true" target="_blank" style="text-decoration: none;" class="doc-item" data-name="Level Flight Data Reduction Excel">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #f59e0b, #92400e);">
                                    <span class="btn-icon">üìä</span>
                                    <span class="btn-text">Data Reduction Level Flight</span>
                                </button>
                            </a>
                            <a href="https://docs.google.com/spreadsheets/d/1uRuGo9gs7DPGNLruZzp4m7EVaG7n0QNu/edit?usp=sharing&ouid=107800747874909130471&rtpof=true&sd=true" target="_blank" style="text-decoration: none;" class="doc-item" data-name="PEC Data Reduction Excel">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #f59e0b, #92400e);">
                                    <span class="btn-icon">üìä</span>
                                    <span class="btn-text">Data Reduction PEC</span>
                                </button>
                            </a>
                            <a href="https://docs.google.com/spreadsheets/d/1z-AWNpwBIpQFc280hivktrMKi5cBPVeU/edit?usp=sharing&ouid=107800747874909130471&rtpof=true&sd=true" target="_blank" style="text-decoration: none;" class="doc-item" data-name="Stall Speeds Data Reduction Excel">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #f59e0b, #92400e);">
                                    <span class="btn-icon">üìä</span>
                                    <span class="btn-text">Data Reduction Stall Speeds</span>
                                </button>
                            </a>
                            <a href="https://docs.google.com/spreadsheets/d/1CMViOq_zcYTg_Ie0D2qHtSUpHEO8zL2q/edit?usp=sharing&ouid=107800747874909130471&rtpof=true&sd=true" target="_blank" style="text-decoration: none;" class="doc-item" data-name="Take off Landing Data Reduction Excel">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #f59e0b, #92400e);">
                                    <span class="btn-icon">üìä</span>
                                    <span class="btn-text">Data Reduction Take off Landing</span>
                                </button>
                            </a>

                            <!-- GROUP 2: Checklists -->
                            <a href="https://drive.google.com/file/d/1PWvetAYTPKXS7fPij9DILnju8MBSbVHk/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="C340 C-GZSN CHECKLIST">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #059669, #064e3b);">
                                    <span class="btn-icon">üõ©Ô∏è</span>
                                    <span class="btn-text">C340 (C-GZSN) Checklist</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/17CETBgdKO0HcnYHmvHGWnLw-RjgCkAhK/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="C340 SIMPLE CHECKLIST">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #059669, #064e3b);">
                                    <span class="btn-icon">üõ©Ô∏è</span>
                                    <span class="btn-text">C340 Simple Checklist</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/1COYQ92yRzG5xrQ3h3H6pwuOHejYhuNmK/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="IAR 823 CHECKLIST">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #059669, #064e3b);">
                                    <span class="btn-icon">üõ©Ô∏è</span>
                                    <span class="btn-text">IAR 823 Checklist</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/1yNIiOHMpnkfjJ6ahp0KceWvnunzFkOYN/view?usp=drive_link" target="_blank" style="text-decoration: none;" class="doc-item" data-name="C340 C-GRAS">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #059669, #064e3b);">
                                    <span class="btn-icon">üõ©Ô∏è</span>
                                    <span class="btn-text">C340 (C-GRAS)</span>
                                </button>
                            </a>

                             <!-- GROUP 3: Student Materials -->
                            <a href="https://itpscanadaltd.sharepoint.com/sites/FWStudentsCoursesMaterial" target="_blank" style="text-decoration: none;" class="doc-item" data-name="FW Students Material">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #0ea5e9, #0284c7);">
                                    <span class="btn-icon">üìÇ</span>
                                    <span class="btn-text">FW Students Material</span>
                                </button>
                            </a>
                            <a href="https://itpscanadaltd.sharepoint.com/sites/itpsstudents/commonfiles" target="_blank" style="text-decoration: none;" class="doc-item" data-name="Flight Prep and Common Files">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #0ea5e9, #0284c7);">
                                    <span class="btn-icon">üìÅ</span>
                                    <span class="btn-text">Flight Prep and Common Files</span>
                                </button>
                            </a>
                            <a href="https://itpscanadaltd.sharepoint.com/sites/itpsstudents/FWmanuals" target="_blank" style="text-decoration: none;" class="doc-item" data-name="FW Academic Manuals">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #0ea5e9, #0284c7);">
                                    <span class="btn-icon">üìö</span>
                                    <span class="btn-text">FW Academic Manuals</span>
                                </button>
                            </a>

                            <!-- GROUP 4: B787 Documents -->
                            <a href="https://drive.google.com/file/d/15Z6_9evv7ZmyywThSaspLRzvfdBgmFTO/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="B787 FCOM">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #1e293b, #0f172a);">
                                    <span class="btn-icon">‚úàÔ∏è</span>
                                    <span class="btn-text">B787 FCOM</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/1ab6SXFVBo_fj55M7yW3D8YaUwGZsoHbf/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="B787 Collection Tutorial">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #1e293b, #0f172a);">
                                    <span class="btn-icon">üìñ</span>
                                    <span class="btn-text">B787 Collection Tutorial</span>
                                </button>
                            </a>
                            <a href="https://drive.google.com/file/d/1YkbI52T6SN1SowMoEYw-0afgZjXKYDTc/view?usp=sharing" target="_blank" style="text-decoration: none;" class="doc-item" data-name="B787 Collection Users Manual">
                                <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #1e293b, #0f172a);">
                                    <span class="btn-icon">üìñ</span>
                                    <span class="btn-text">B787 Users Manual</span>
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }


        function filterDocuments() {
            const searchTerm = document.getElementById('docSearch').value.toLowerCase();
            const docItems = document.querySelectorAll('.doc-item');

            docItems.forEach(item => {
                const docName = item.getAttribute('data-name').toLowerCase();
                if (docName.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function renderWBMenu() {
            const root = document.getElementById('root');
            root.innerHTML = `
                <div class="container" style="padding-top: 2rem;">
                    <button class="btn-back" onclick="goBackHome()">‚Üê Back Home</button>
                    <div class="card">
                        <h2>‚öñÔ∏è Weight and Balance</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1.5rem;">
                            <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #4f46e5, #312e81);" onclick="startWB()">
                                <span class="btn-icon">üë®‚Äç‚úàÔ∏è</span>
                                <span class="btn-text">Student W&B</span>
                            </button>
                            <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #4f46e5, #312e81);" onclick="state.screen = 'fleet'; state.fleetSearch = ''; render()">
                                <span class="btn-icon">‚úàÔ∏è</span>
                                <span class="btn-text">Call Signs</span>
                            </button>
                            <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #059669, #064e3b);" onclick="selectAircraft('CGRAS')">
                                <span class="btn-icon">üõ©Ô∏è</span>
                                <span class="btn-text">C340-CGRAS</span>
                            </button>
                            <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #059669, #064e3b);" onclick="selectAircraft('CGZSN')">
                                <span class="btn-icon">üõ©Ô∏è</span>
                                <span class="btn-text">C340-CGZSN</span>
                            </button>
                            <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #059669, #064e3b);" onclick="selectAircraft('CFYWI')">
                                <span class="btn-icon">üõ©Ô∏è</span>
                                <span class="btn-text">SR22-CFYWI</span>
                            </button>
                            <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #059669, #064e3b);" onclick="selectAircraft('CFZJJ')">
                                <span class="btn-icon">üõ©Ô∏è</span>
                                <span class="btn-text">SR22-CFZJJ</span>
                            </button>
                            <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #be123c, #881337);" onclick="renderIAR823()">
                                <span class="btn-icon">üõ©Ô∏è</span>
                                <span class="btn-text">IAR823-CFPIU</span>
                            </button>
                            <button class="btn-premium-dashboard" style="background: linear-gradient(135deg, #0369a1, #0c4a6e);" onclick="renderMinFuelsAltitudes()">
                                <span class="btn-icon">‚õΩ</span>
                                <span class="btn-text">Min Fuels VFR & Min Altitudes AGL</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMinFuelsAltitudes() {
            const root = document.getElementById('root');
            root.innerHTML = `
                <div class="container" style="padding-top: 2rem;">
                    <button class="btn-back" onclick="renderWBMenu()">‚Üê Back</button>

                    <!-- Search Bar -->
                    <div style="margin-bottom: 1.5rem;">
                        <input id="minFuelAltSearch" type="text" placeholder="üîç  Search maneuver or aircraft..."
                            oninput="filterMinFuelAlt()"
                            style="width:100%; padding:0.9rem 1.2rem; border-radius:0.75rem; border:2px solid #e2e8f0;
                                   font-size:1rem; outline:none; transition:border-color 0.2s;"
                            onfocus="this.style.borderColor='#3b82f6'" onblur="this.style.borderColor='#e2e8f0'">
                    </div>

                    <!-- Minimum Fuels Day VFR -->
                    <div class="card" id="fuelCard">
                        <h2 style="font-size:1.4rem; margin-bottom:0.5rem;">‚õΩ Minimum Fuels Day VFR</h2>
                        <p style="font-size:0.85rem; color:#64748b; margin-bottom:1.25rem; font-style:italic;">
                            To be onboard when joining the pattern at destination.
                        </p>
                        <div style="overflow-x:auto;">
                            <table style="width:100%; border-collapse:collapse; font-size:0.9rem;" id="fuelTable">
                                <thead>
                                    <tr style="background:#1e293b; color:#38bdf8;">
                                        <th style="padding:12px 14px; text-align:left; border-radius:8px 0 0 0; font-weight:800; text-transform:uppercase; letter-spacing:0.05em;">Aircraft</th>
                                        <th style="padding:12px 14px; text-align:center; border-radius:0 8px 0 0; font-weight:800; text-transform:uppercase; letter-spacing:0.05em;">Minimum Fuel ‚Äî 1000 AGL CYXU</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${[
                                        ['SR22', '10 USG'],
                                        ['SU29', '30 liters'],
                                        ['IAR83', '30 liters'],
                                        ['LONG EZ', '5 USG'],
                                        ['C414/C340', '15 USG'],
                                        ['L29', '300 liters'],
                                        ['L39', '350 liters'],
                                        ['HUNTER', '1 200 Lbs.'],
                                    ].map(([ac, fuel], i) => `
                                        <tr class="fuel-row" data-name="${ac.toLowerCase()}"
                                            style="background:${i % 2 === 0 ? 'rgba(241,245,249,0.6)' : 'white'}; transition:background 0.15s;">
                                            <td style="padding:11px 14px; font-weight:700; color:#1e293b; border-bottom:1px solid #e2e8f0;">${ac}</td>
                                            <td style="padding:11px 14px; text-align:center; font-weight:700; color:#059669; border-bottom:1px solid #e2e8f0;">${fuel}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Minimum Altitudes AGL -->
                    <div class="card" id="altCard" style="margin-top:1.5rem;">
                        <h2 style="font-size:1.4rem; margin-bottom:1.25rem;">üèîÔ∏è Minimum Altitudes AGL</h2>
                        <div style="overflow-x:auto;">
                            <table style="width:100%; border-collapse:collapse; font-size:0.9rem;" id="altTable">
                                <thead>
                                    <tr style="background:#1e293b; color:#38bdf8;">
                                        <th style="padding:12px 14px; text-align:left; border-radius:8px 0 0 0; font-weight:800; text-transform:uppercase; letter-spacing:0.05em;">FTT / Maneuver</th>
                                        <th style="padding:12px 14px; text-align:center; font-weight:800; text-transform:uppercase; letter-spacing:0.05em;">With IP</th>
                                        <th style="padding:12px 14px; text-align:center; border-radius:0 8px 0 0; font-weight:800; text-transform:uppercase; letter-spacing:0.05em;">Solo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${[
                                        ['PFL', '1 000', '2 000'],
                                        ['Aerobatics and WUT', '3 000', '4 000'],
                                        ['Power off Stall KIO', '3 000', '4 000'],
                                        ['Power on Stall KIO', '4 000', '5 000'],
                                        ['Any TP below 1.2 Vs', '3 000', '4 000'],
                                        ['Climb Perf set up', '500', '1 000'],
                                        ['TFB above runway', '80', '100'],
                                        ['EGPWS/GPS Ground Course above runway', '150', '200'],
                                        ['LMS/LDDS', '2 000', '3 000'],
                                        ['VMCA dynamic and static', '3 000', '4 000'],
                                        ['SPINS departure JET', '14 000', '15 000'],
                                        ['SPINS recovery initiation JET', '10 000', '10 000'],
                                        ['SPINS departure NON-JET', '4 000', '5 000'],
                                        ['SPINS recovery initiation NON-JET', '3 000', '4 000'],
                                        ['HQ with Target', '3 000', '4 000'],
                                        ['Unusual attitude', '3 000', '4 000'],
                                    ].map(([maneuver, ip, solo], i) => `
                                        <tr class="alt-row" data-name="${maneuver.toLowerCase()}"
                                            style="background:${i % 2 === 0 ? 'rgba(241,245,249,0.6)' : 'white'}; transition:background 0.15s;">
                                            <td style="padding:11px 14px; font-weight:600; color:#1e293b; border-bottom:1px solid #e2e8f0;">${maneuver}</td>
                                            <td style="padding:11px 14px; text-align:center; font-weight:700; color:#0369a1; border-bottom:1px solid #e2e8f0;">${ip} ft</td>
                                            <td style="padding:11px 14px; text-align:center; font-weight:700; color:#be123c; border-bottom:1px solid #e2e8f0;">${solo} ft</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function filterMinFuelAlt() {
            const q = document.getElementById('minFuelAltSearch').value.toLowerCase().trim();

            document.querySelectorAll('.alt-row').forEach(row => {
                row.style.display = row.dataset.name.includes(q) ? '' : 'none';
            });
            document.querySelectorAll('.fuel-row').forEach(row => {
                row.style.display = row.dataset.name.includes(q) ? '' : 'none';
            });

            // Hide entire card if all rows hidden
            const altVisible = [...document.querySelectorAll('.alt-row')].some(r => r.style.display !== 'none');
            const fuelVisible = [...document.querySelectorAll('.fuel-row')].some(r => r.style.display !== 'none');
            const altCard = document.getElementById('altCard');
            const fuelCard = document.getElementById('fuelCard');
            if (altCard) altCard.style.display = altVisible ? '' : 'none';
            if (fuelCard) fuelCard.style.display = fuelVisible ? '' : 'none';
        }

        // Global App State

        let state = {
            screen: 'aircraft',
            selectedAircraft: null,
            runwayMode: null,
            altitude: '',
            iar823: { oat: 20, weight: 3000, wind: 10, climbWeight: '3300' },
            temperature: '',
            weights: {},
            allResults: null,
            wb: { frontLeft: "", frontRight: "", centreLeft: "", centreRight: "", rear: "", manualWeights: {} },
            personnelSearch: "",
            weatherData: null,
            weatherLoading: false,
            bananaMode: false,
            showWindy: false,
            sidebarHidden: false,
            fleetSearch: ''
        };

        function saveState() {
            localStorage.setItem('itps_tools_state', JSON.stringify({
                runway: state.runway,
                fleet: state.fleet,
                altitude: state.altitude,
                temperature: state.temperature,
                weights: state.weights,
                iar823: state.iar823
            }));
        }

        function loadState() {
            const saved = localStorage.getItem('itps_tools_state');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    state.runway = { ...state.runway, ...parsed.runway };
                    state.fleet = { ...state.fleet, ...parsed.fleet };
                    state.altitude = parsed.altitude || '';
                    state.temperature = parsed.temperature || '';
                    state.weights = parsed.weights || {};
                    if (parsed.iar823) state.iar823 = { ...state.iar823, ...parsed.iar823 };
                } catch (e) { console.error("Load state failed", e); }
            }
        }
        loadState();
        render();

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW failed', err));
            });
        }
    </script>
</body>

</html>